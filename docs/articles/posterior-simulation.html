<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gratia">
<title>Posterior Simulation • gratia</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Posterior Simulation">
<meta property="og:description" content="gratia">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gratia</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1.56</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/gratia.html">Get started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/custom-plotting.html">Customizing plots</a>
    <a class="dropdown-item" href="../articles/data-slices.html">Data slices</a>
    <a class="dropdown-item" href="../articles/posterior-simulation.html">Posterior Simulation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gavinsimpson/gratia/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Posterior Simulation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gavinsimpson/gratia/blob/HEAD/vignettes/posterior-simulation.Rmd" class="external-link"><code>vignettes/posterior-simulation.Rmd</code></a></small>
      <div class="d-none name"><code>posterior-simulation.Rmd</code></div>
    </div>

    
    
<p><introduction></introduction></p>
<p>We’ll need the following packages for this article</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"mgcv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: nlme</span></span>
<span><span class="co">#&gt; This is mgcv 1.9-0. For overview type 'help("mgcv-package")'.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://gavinsimpson.github.io/gratia/">"gratia"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:nlme':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     collapse</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://mjskay.github.io/ggdist/" class="external-link">"ggdist"</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="what-are-we-simulating">What are we simulating?<a class="anchor" aria-label="anchor" href="#what-are-we-simulating"></a>
</h2>
<p>There are multiple types of values that we can simulate from a fitted
GAM. We might simulate from the posterior distribution of a single
estimated smooth function to see the uncertainty in the estimate of that
function. Instead we might be interested in the uncertainty in the
expectation (expected value) of the model at some given values of the
covariates. Or we might want to generate new values of response variable
via draws from the conditional distribution of the response, again at
given covariate values. Finally we might want to combine the latter two
options, simulating new values of the response data that also include
the uncertainty in the expected values.</p>
<p>gratia allows you to do all of the above through the following
functions</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> generates draws from the posterior
distribution of single estimated smooth functions,</li>
<li>
<code><a href="../reference/fitted_samples.html">fitted_samples()</a></code> generates draws from the posterior
distribution of <span class="math inline">\(\mathbb{E}(y_i |
\mathbf{X}_i = x_i)\)</span>, the expected value of the responss,</li>
<li>
<code><a href="../reference/predicted_samples.html">predicted_samples()</a></code>, generates new response data given
supplied values of covariates <span class="math inline">\(y^{*}_i |
\mathbf{X}_i = x^{*}_i\)</span>
</li>
<li>
<code><a href="../reference/posterior_samples.html">posterior_samples()</a></code>, generates draws from the posterior
distribution of the model, including the uncertainty in the estimated
parameters of that model.</li>
</ol>
<p>In simpler terms, <code><a href="../reference/fitted_samples.html">fitted_samples()</a></code> generates predictions
about the “average” or expected value of the response at values of the
covariates. These predictions only include the uncertainty in the
estimated values of the model coefficients. In contrast,
<code><a href="../reference/posterior_samples.html">posterior_samples()</a></code> generates predictions of the actual
values of the response we might expect to observe (if the model is
correct) given values of the covariates. These predicted values include
the variance of the sampling distribution (error term).
<code><a href="../reference/predicted_samples.html">predicted_samples()</a></code> lies somewhere in between these two;
the predicted values only include the variation in the sampling
distribution, and take the model as fixed, known.</p>
<p>It is worth reminding ourselves that these posterior draws are all
conditional upon the selected values of the smoothing parameter(s) <span class="math inline">\(\lambda_j\)</span>. We act as if the wiggliness of
the estimated smooths was known, when in actual fact we estimated
(selected is perhaps a better description) these wiglinesses from the
data during model fitting. If the estimated GAM has been fitted with
<code>method</code> argument set to <code>"REML"</code>, or
<code>"ML"</code>, then a covariace matrix corrected for smoothing
parameter uncertainty, <span class="math inline">\(V_c\)</span>, is
available, which, to an extent, allows for the posterior simulation to
account for this additional source of uncertainty. Regardless, the GAMs
we fit with {mgcv} are <em>empirical</em> bayes models, and I need
something here to explain this from Dave’s Bayesian GAM primer.</p>
<p>There are two additional functions available in gratia that do
posterior simulation:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate()</a></code>, and</li>
<li>
<code><a href="../reference/derivative_samples.html">derivative_samples()</a></code>.</li>
</ul>
<p>gratia provides <code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate()</a></code> methods for models estimated
using <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam()</a></code>, and <code><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">gamm()</a></code>,
as well as those fitted via <code>scam()</code> in the scam package.
<code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate()</a></code> is a base R convention that does the same thing
as <code><a href="../reference/predicted_samples.html">predicted_samples()</a></code>, just in a non-tidy way (that is not
perjorative; it returns the simulated response values as a matrix, which
is arguably more useful if you are doing math or further statistical
computation.) <code><a href="../reference/derivative_samples.html">derivative_samples()</a></code> provides draws from the
posterior distribution of the derivative of response variable for a
given change in a focal covariate value.
<code><a href="../reference/derivative_samples.html">derivative_samples()</a></code> is less general version of
<code><a href="../reference/fitted_samples.html">fitted_samples()</a></code>; you could achieve the same thing by two
separate calls to <code><a href="../reference/fitted_samples.html">fitted_samples()</a></code>. We’ll reserver
discussion of <code><a href="../reference/derivative_samples.html">derivative_samples()</a></code> to a separate vignette
focused on estimating derivatives from GAMs.</p>
<p>In the following sections we’ll look at each of the four main
posterior simulation functions in turn.</p>
</div>
<div class="section level2">
<h2 id="smooth_samples">
<code>smooth_samples()</code><a class="anchor" aria-label="anchor" href="#smooth_samples"></a>
</h2>
</div>
<div class="section level2">
<h2 id="fitted_samples">
<code>fitted_samples()</code><a class="anchor" aria-label="anchor" href="#fitted_samples"></a>
</h2>
</div>
<div class="section level2">
<h2 id="predicted_samples">
<code>predicted_samples()</code><a class="anchor" aria-label="anchor" href="#predicted_samples"></a>
</h2>
</div>
<div class="section level2">
<h2 id="posterior_samples">
<code>posterior_samples()</code><a class="anchor" aria-label="anchor" href="#posterior_samples"></a>
</h2>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Gavin L. Simpson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
