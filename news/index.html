<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Changelog • gratia</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Changelog"><meta property="og:image" content="https://gavinsimpson.github.io/gratia/reference/figures/README-draw-gam-figure-1.png"><meta property="og:image:alt" content="Plot produced by draw() of 4 smooth functions from a fitted generalized additive model"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@ucfagls"><meta name="twitter:site" content="@ucfagls"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gratia</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.10.0.9024</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/gratia.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/custom-plotting.html">Customizing plots</a></li>
    <li><a class="dropdown-item" href="../articles/data-slices.html">Data slices</a></li>
    <li><a class="dropdown-item" href="../articles/posterior-simulation.html">Posterior Simulation</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gavinsimpson/gratia/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-news">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Changelog</h1>
      <small>Source: <a href="https://github.com/gavinsimpson/gratia/blob/main/NEWS.md" class="external-link"><code>NEWS.md</code></a></small>
    </div>

    <div class="section level2">
<h2 class="pkg-version" data-toc-text="development version" id="gratia-development-version">gratia (development version)<a class="anchor" aria-label="anchor" href="#gratia-development-version"></a></h2>
<p><em>gratia</em> now has a <a href="https://doi.org/10.21105/joss.06962" class="external-link">paper</a> describing the package in the <a href="https://joss.theoj.org/" class="external-link">Journal of Open Source Software</a>. If you use <em>gratia</em> in your work, please cite this paper rather than the generic citation previously created by <code><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation()</a></code>:</p>
<blockquote>
<p>Simpson, G.L. (2024) gratia: An R package for exploring generalized additive models. <em>The Journal of Open Source Software</em> <strong>9</strong>, 6962.</p>
</blockquote>
<div class="section level3">
<h3 id="user-visible-changes-development-version">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-development-version"></a></h3>
<ul><li><p>Experimental support for computing with parallel processes via the <em>purrr</em> 📦 in <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> and <code><a href="../reference/basis.html">basis()</a></code>, though it is of limited use in the latter. Parallel processing will operate if a call to <code><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">mirai::daemons()</a></code> has been issued in the current R session.</p></li>
<li><p>Rug plots in <code><a href="../reference/draw.gam.html">draw.gam()</a></code> now only show the unique data values to avoid needless overplotting. This behaviour is controlled via new argument <code>distinct_rug</code>. Setting this to <code>FALSE</code> will get the previous behaviour.</p></li>
<li><p><code><a href="../reference/simulate.html">simulate.gam()</a></code> gains a <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> method and thus no longer prints its attributes.</p></li>
<li><p><code>citation("gratia")</code> now suggests to use Simpson (2024) <em>Journal of Open Source Software</em> <strong>9</strong>(104), 9862, when citing the package.</p></li>
<li><p><code><a href="../reference/simulate.html">simulate.gam()</a></code> now returns a data frame, bringing it into line with <code>stats::simulate.lm()</code>.</p></li>
</ul></div>
<div class="section level3">
<h3 id="new-features-development-version">New features<a class="anchor" aria-label="anchor" href="#new-features-development-version"></a></h3>
<ul><li><p><code><a href="../reference/assemble.html">assemble()</a></code> is a new generic function for assembling sets of plots from model objects. It is effectively <code><a href="../reference/draw.html">draw()</a></code> but without actually plotting on the current device. Instead it returns a list of <code>ggplot</code> objects. Currently, a method for <code>"gam"</code> models, <code><a href="../reference/assemble.gam.html">assemble.gam()</a></code>, is provided which <code><a href="../reference/draw.gam.html">draw.gam()</a></code> uses. Part of the wish of <a href="https://github.com/ha0ye" class="external-link">@ha0ye</a> <a href="https://github.com/gavinsimpson/gratia/issues/35" class="external-link">#35</a></p></li>
<li><p><code><a href="../reference/appraise.html">appraise()</a></code> with <code>method = "simulate"</code> can now handle <em>mgcv</em>’s multivariate normal models fitted with <code>family = mvn()</code>and Tweedie location scale models fitted with <code>family = twlss()</code>.</p></li>
<li>
<p><code>fix_family_rd()</code> is an (currently) internal function that extends <code><a href="https://rdrr.io/pkg/mgcv/man/fix.family.link.html" class="external-link">mgcv::fix.family.rd()</a></code>. This function adds a <code>rfoo()</code> function to the <code>$rd</code> component of the <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">family()</a></code> object stored in the model. This function is used to generate new values of the response at supplied values of the linear predictor. <code>fix_family_rd()</code> calls <code><a href="https://rdrr.io/pkg/mgcv/man/fix.family.link.html" class="external-link">mgcv::fix.family.rd()</a></code> so it is backward compatible with <em>mgcv</em>’s behaviour, but it is designed to extend the behaviour through support for a richer set of models.</p>
<p>Currently, <code>fix_family_rd()</code> adds support for multivariate normal models fitted with <code>family = mvn()</code> and location-scale Tweedie models fitted with <code>family = twlss()</code>, but the latter is currently slow.</p>
<p>The functionality of <code>fix_family_rd()</code> may move to another package or even to <em>mgcv</em> if suitable.</p>
</li>
<li>
<p><code><a href="../reference/difference_smooths.html">difference_smooths()</a></code> can now be used to compare named smooths using <code>select = c("s(x):f1", "s(x):f2")</code> etc, where the vector of smooth names must match exactly something returned by <code><a href="../reference/smooths.html">smooths()</a></code>. Smooths to be compared must have the same covariate (<code>x</code> in the example) and same factor-by variable (<code>f</code> in the example). Tensor product factor-by smooths are handled likewise. This effectively handles the problem of <a href="https://github.com/gavinsimpson/gratia/issues/315" class="external-link">#315</a>, reported by <a href="https://github.com/3rd3" class="external-link">@3rd3</a>.</p>
<p>Additionally, <code><a href="../reference/difference_smooths.html">difference_smooths()</a></code> with <code>group_means = TRUE</code> can now include group means specified using a random effect smooth, e.g. following the above example for <code>select</code>, a random effect smooth <code>s(f, bs = "re")</code>, with name <code>s(f)</code>, is looked for in the model matrix and its effects included in the comparisons.</p>
</li>
<li><p><code><a href="../reference/data_slice.html">data_slice()</a></code> gains argument <code>.observed_only</code> which allows simple filtering of the combinations of values specified in the slice to those that are in the data frame supplied or in the model frame of a fitted GAM.</p></li>
<li><p><code><a href="../reference/posterior_samples.html">posterior_samples()</a></code>, <code><a href="../reference/predicted_samples.html">predicted_samples()</a></code>, <code><a href="../reference/fitted_samples.html">fitted_samples()</a></code>, and <code><a href="../reference/simulate.html">simulate.gam()</a></code> now simulate for all linear predictors (i.e., all responses) in <code><a href="https://rdrr.io/pkg/mgcv/man/mvn.html" class="external-link">mvn()</a></code> and <code><a href="https://rdrr.io/pkg/mgcv/man/multinom.html" class="external-link">multinom()</a></code> models as these are all location parameter linear predictors.</p></li>
<li><p><code><a href="../reference/fitted_values.html">fitted_values()</a></code> now works for GAMs fitted with families <code><a href="https://rdrr.io/pkg/mgcv/man/ziP.html" class="external-link">ziP()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/mvn.html" class="external-link">mvn()</a></code>, and <code><a href="https://rdrr.io/pkg/mgcv/man/multinom.html" class="external-link">multinom()</a></code>. The non-working of <code>fitted-values()</code> for <code><a href="https://rdrr.io/pkg/mgcv/man/ziP.html" class="external-link">ziP()</a></code> models was reported in <a href="https://github.com/gavinsimpson/gratia/issues/341" class="external-link">#341</a> by <a href="https://github.com/rroyaute" class="external-link">@rroyaute</a></p></li>
<li><p><code><a href="../reference/posterior_samples.html">posterior_samples()</a></code>, <code><a href="../reference/fitted_samples.html">fitted_samples()</a></code>, <code><a href="../reference/predicted_samples.html">predicted_samples()</a></code>, <code>derivatives_samples()</code>, and <code><a href="../reference/response_derivatives.html">response_derivatives()</a></code> now all work with models fitted by <code><a href="https://rdrr.io/pkg/scam/man/scam.html" class="external-link">scam::scam()</a></code>.</p></li>
<li><p><code><a href="../reference/basis.html">basis()</a></code> can now take a vector of coefficients for the basis functions when using the default method: <code>basis(s(x), data = df, coefficients = rnorm(10))</code>. Wish of <a href="https://github.com/gavinsimpson/gratia/issues/136" class="external-link">#136</a></p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-development-version">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-development-version"></a></h3>
<ul><li><p><code><a href="../reference/conditional_values.html">conditional_values()</a></code> would fail if a variable it was conditioning on was also a name of a function. <a href="https://github.com/gavinsimpson/gratia/issues/323" class="external-link">#323</a> (but not really fixed when this was initially closed)</p></li>
<li><p><code><a href="../reference/parametric_effects.html">parametric_effects()</a></code> was only keeping one set of factor levels when there were multiple parametric factor terms in a model. Reported by <a href="https://github.com/tamas-ferenci" class="external-link">@tamas-ferenci</a> as part of discussion to <a href="https://github.com/gavinsimpson/gratia/issues/284" class="external-link">#284</a></p></li>
<li><p><code><a href="../reference/mh_draws.html">mh_draws()</a></code> would fail in the case of drawing only <code>n = 1</code> samples. <a href="https://github.com/gavinsimpson/gratia/issues/328" class="external-link">#328</a> Reported by <a href="https://github.com/zsusswein" class="external-link">@zsusswein</a></p></li>
<li><p><code><a href="../reference/simulate.html">simulate.gam()</a></code> now works for the <code><a href="https://rdrr.io/pkg/mgcv/man/ocat.html" class="external-link">ocat()</a></code> family, which has a non-standard <code>rd</code> function in its <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">family()</a></code> object. Reported by <a href="https://github.com/hhp94" class="external-link">@hhp94</a>, <a href="https://github.com/gavinsimpson/gratia/issues/319" class="external-link">#319</a></p></li>
<li><p><code><a href="../reference/gaussian_draws.html">gaussian_draws()</a></code> would fail in some cases with <em>gamm4</em> models because the coefficients were returned as a vector, not the expected matrix. <a href="https://github.com/gavinsimpson/gratia/issues/332" class="external-link">#332</a> reported by <a href="https://github.com/JaredStufft-Elion" class="external-link">@JaredStufft-Elion</a></p></li>
<li><p><code><a href="../reference/draw.smooth_estimates.html">draw.smooth_estimates()</a></code> would generate very many warnings when plotting spline on the sphere smoothers (<code>bs = "sos"</code>) because <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile()</a></code> was creating tiles that extended beyond valid geographical coordinates for the tile centre coordinates that it was being provided. The function that creates the data to evaluate the spline at now tries to avoid this. Note this fix is not a complete solution. <a href="https://github.com/gavinsimpson/gratia/issues/334" class="external-link">#334</a> Reported by <a href="https://github.com/StefanoMezzini" class="external-link">@StefanoMezzini</a></p></li>
<li><p><code><a href="../reference/link.html">link()</a></code> and <code><a href="../reference/link.html">inv_link()</a></code> failed to extract the link an inverse link functions for <code><a href="https://rdrr.io/pkg/mgcv/man/mvn.html" class="external-link">mvn()</a></code> and <code><a href="https://rdrr.io/pkg/mgcv/man/multinom.html" class="external-link">multinom()</a></code> models.</p></li>
<li><p><code><a href="../reference/link.html">link()</a></code> and <code><a href="../reference/link.html">inv_link()</a></code> now work correctly for models fitted with the <code><a href="https://rdrr.io/pkg/mgcv/man/ziP.html" class="external-link">ziP()</a></code> family. <a href="https://github.com/gavinsimpson/gratia/issues/341" class="external-link">#341</a> Reported by <a href="https://github.com/rroyaute" class="external-link">@rroyaute</a></p></li>
<li><p><code><a href="../reference/basis.html">basis.scam()</a></code> was incorrectly trying to identify the smooths named in <code>select</code>.</p></li>
<li><p><code><a href="../reference/basis.html">basis.scam()</a></code> would fail if the SCAM contained any non-constrained (i.e.  ordinary) smooths.</p></li>
<li><p><code><a href="../reference/overview.html">overview()</a></code> was displaying more significant digits in the p values than it was accurate to in terms of reporting p values as “&lt;0.001”. A new argument <code>digits</code> controls how many digits are used when formatting p values, with default of <code>3</code>.</p></li>
<li><p><code><a href="../reference/theta.html">theta()</a></code> now works for models fitted with the <code><a href="https://rdrr.io/pkg/mgcv/man/gfam.html" class="external-link">gfam()</a></code> family. Previously it would fail because it assumes all <code>family()$getTheta</code> functions had an argument <code>trans</code> to transform the theta values to the correct scale.</p></li>
<li><p><code><a href="../reference/overview.html">overview()</a></code> was not showing the model intercept, and was displaying slightly different results from those shown by <code><a href="https://rdrr.io/pkg/mgcv/man/summary.gam.html" class="external-link">summary.gam()</a></code>.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.10.0" id="gratia-0100">gratia 0.10.0<a class="anchor" aria-label="anchor" href="#gratia-0100"></a></h2><p class="text-muted">CRAN release: 2024-12-19</p>
<div class="section level3">
<h3 id="new-features-0-10-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-10-0"></a></h3>
<ul><li><p><code><a href="../reference/conditional_values.html">conditional_values()</a></code> and its <code><a href="../reference/draw.html">draw()</a></code> method compute and plot predictions from a fitted GAM that are conditional on one or more covariates. The function is a wrapper around <code><a href="../reference/fitted_values.html">fitted_values()</a></code> but allows the user simple ways to specify which covariates to condition on and at what values those covariates should take. It provides similar functionality to <code><a href="https://marginaleffects.com/man/r/plot_predictions.html" class="external-link">marginaleffects::plot_predictions()</a></code>, but is simpler. See <a href="https://github.com/gavinsimpson/gratia/issues/300" class="external-link">#300</a>.</p></li>
<li><p><code><a href="../reference/penalty.html">penalty()</a></code> and <code><a href="../reference/basis.html">basis()</a></code> can now allow the smooth to be reparameterized such that the resulting basis has an identity matrix. This more clearly highlights the penalty null space, the functions that the penalty has no effect on.</p></li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> and <code><a href="../reference/draw.smooth_estimates.html">draw.smooth_estimates()</a></code> gain argument <code>caption</code>, which, if set to <code>FALSE</code> will not plot the smooth basis type as a caption on the plot. <a href="https://github.com/gavinsimpson/gratia/issues/307" class="external-link">#307</a></p></li>
<li><p><code><a href="../reference/appraise.html">appraise()</a></code> and <code><a href="../reference/qq_plot.html">qq_plot.gam()</a></code> now allow the user to set a random seed that is used when generating reference quantiles with <code>method = "uniform"</code> or <code>method = "simulate"</code>.</p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-10-0">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-10-0"></a></h3>
<ul><li><p><code><a href="../reference/derivative_samples.html">derivative_samples()</a></code> was ignoring the <code>scale</code> argument. <a href="https://github.com/gavinsimpson/gratia/issues/293" class="external-link">#293</a> Reported by <a href="https://github.com/jonathonmellor" class="external-link">@jonathonmellor</a></p></li>
<li><p>Argument <code>level</code> to <code><a href="../reference/derivative_samples.html">derivative_samples()</a></code> was included accidentally. As of v0.9.2.9002 this argument is deprecated and using it will now generate a warning. <a href="https://github.com/gavinsimpson/gratia/issues/291" class="external-link">#291</a></p></li>
<li><p><code><a href="../reference/draw.html">draw()</a></code> was not plotting cyclic P spline smooths. Reported by <a href="https://github.com/Zuckerbrot" class="external-link">@Zuckerbrot</a> <a href="https://github.com/gavinsimpson/gratia/issues/297" class="external-link">#297</a></p></li>
<li><p><code><a href="../reference/derivatives.html">derivatives()</a></code> would fail for <code>"fs"</code> smooths with other parametric effects in the model. Reported by <a href="https://github.com/mahonmb" class="external-link">@mahonmb</a> <a href="https://github.com/gavinsimpson/gratia/issues/301" class="external-link">#301</a></p></li>
<li><p>Partial residuals in <code><a href="../reference/partial_residuals.html">partial_residuals()</a></code> and <code><a href="../reference/draw.gam.html">draw.gam()</a></code> were wrong for GAMs fitted with <code>family = binomial()</code> where the <code>weights</code> argument contained the binomial sample sizes because the prior weights were being used to form weighted working residuals. Now working weights are used instead. Reported by <a href="https://github.com/emchuron" class="external-link">@emchuron</a> <a href="https://github.com/gavinsimpson/gratia/issues/273" class="external-link">#273</a></p></li>
<li><p>Internal function <code>gammals_link()</code> was expecting <code>"theta"</code> as a synonym for the scale parameter but the master table has <code>"phi"</code> coded as the synonym. Now both work as expected.</p></li>
<li><p><code><a href="../reference/ref_level.html">level()</a></code> assumed that <code>level</code> would have only a single value even though it could handle multiple levels. <a href="https://github.com/gavinsimpson/gratia/issues/321" class="external-link">#321</a></p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.9.2" id="gratia-092">gratia 0.9.2<a class="anchor" aria-label="anchor" href="#gratia-092"></a></h2><p class="text-muted">CRAN release: 2024-06-25</p>
<div class="section level3">
<h3 id="breaking-changes-0-9-2">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-9-2"></a></h3>
<ul><li>
<code><a href="../reference/parametric_effects.html">parametric_effects()</a></code> slightly escaped the great renaming that happened for 0.9.0. Columns <code>type</code> and <code>term</code> did not gain a prefix <code>.</code>. This is now rectified and these two columns are now <code>.type</code> and <code>.term</code>.</li>
</ul></div>
<div class="section level3">
<h3 id="user-visible-changes-0-9-2">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-9-2"></a></h3>
<ul><li><p>Plots of random effects are now labelled with their smooth label. Previously, the title was taken fro the variable involved in the smooth, but this doesn’t work for terms like <code>s(subject, continuous_var, bs = "re")</code> for random slopes, which previously would have the title <code>"subject"</code>. Now such terms will have title <code>"s(subject,continuous_var)"</code>. Simple random intercept terms, <code>s(subject, bs = "re")</code>, are now titled <code>"s(subject)"</code>. <a href="https://github.com/gavinsimpson/gratia/issues/287" class="external-link">#287</a></p></li>
<li>
<p>The vignettes</p>
<ol style="list-style-type: decimal"><li>
<code>custom-plotting.Rmd</code>, and</li>
<li>
<code>posterior-simulation.Rmd</code> were moved to <code>vignettes/articles</code> and thus are no longer available as package vignettes. Instead, they are accessible as Articles through the package website: <a href="https://gavinsimpson.github.io/gratia/" class="uri">https://gavinsimpson.github.io/gratia/</a>
</li>
</ol></li>
</ul></div>
<div class="section level3">
<h3 id="new-features-0-9-2">New features<a class="anchor" aria-label="anchor" href="#new-features-0-9-2"></a></h3>
<ul><li>
<code><a href="../reference/fitted_samples.html">fitted_samples()</a></code> now works for <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam()</a></code> models with multiple linear predictors, but currently only the location parameter is supported. The parameter is indicated through a new variable <code>.parameter</code> in the returned object.</li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-9-2">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-9-2"></a></h3>
<ul><li><p><code><a href="../reference/partial_residuals.html">partial_residuals()</a></code> was computing partial residuals from the <em>deviance</em> residuals. For compatibility with <code><a href="https://rdrr.io/pkg/mgcv/man/plot.gam.html" class="external-link">mgcv::plot.gam()</a></code>, partial residuals are now computed from the <em>working</em> residuals. Reported by <a href="https://github.com/wStockhausen" class="external-link">@wStockhausen</a> <a href="https://github.com/gavinsimpson/gratia/issues/273" class="external-link">#273</a></p></li>
<li><p><code><a href="../reference/appraise.html">appraise()</a></code> was not passing the <code>ci_col</code> argument on <code><a href="../reference/qq_plot.html">qq_plot()</a></code> and <code><a href="../reference/worm_plot.html">worm_plot()</a></code>. Reported by Sate Ahmed.</p></li>
<li><p>Couldn’t pass <code>mvn_method</code> on to posterior sampling functions from user facing functions <code><a href="../reference/fitted_samples.html">fitted_samples()</a></code>, <code><a href="../reference/posterior_samples.html">posterior_samples()</a></code>, <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code>, <code><a href="../reference/derivative_samples.html">derivative_samples()</a></code>, and <code>repsonse_derivatives()</code>. Reported by <a href="https://github.com/stefgehrig" class="external-link">@stefgehrig</a> <a href="https://github.com/gavinsimpson/gratia/issues/279" class="external-link">#279</a></p></li>
<li><p><code><a href="../reference/fitted_values.html">fitted_values()</a></code> works again for quantile GAMs fitted by <code>qgam()</code>.</p></li>
<li><p><code><a href="../reference/confint.gam.html">confint.gam()</a></code> was not applying <code>shift</code> to the estimate and upper and lower interval. <a href="https://github.com/gavinsimpson/gratia/issues/280" class="external-link">#280</a> reported by <a href="https://github.com/TIMAVID" class="external-link">@TIMAVID</a> &amp; <a href="https://github.com/rbentham" class="external-link">@rbentham</a></p></li>
<li><p><code><a href="../reference/parametric_effects.html">parametric_effects()</a></code> and <code><a href="../reference/draw.parametric_effects.html">draw.parametric_effects()</a></code> would forget about the levels of factors (intentionally), but this would lead to problems with ordered factors where the ordering of levels was not preserved. Now, <code><a href="../reference/parametric_effects.html">parametric_effects()</a></code> returns a named list of factor levels as attribute <code>"factor_levels"</code> containing the required information and the order of levels is preserved when plotting. <a href="https://github.com/gavinsimpson/gratia/issues/284" class="external-link">#284</a> Reported by <a href="https://github.com/mhpob" class="external-link">@mhpob</a></p></li>
<li><p><code><a href="../reference/parametric_effects.html">parametric_effects()</a></code> would fail if there were parametric terms in the model but they were all interaction terms (which we don’t currently handle). <a href="https://github.com/gavinsimpson/gratia/issues/282" class="external-link">#282</a></p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.9.0" id="gratia-090">gratia 0.9.0<a class="anchor" aria-label="anchor" href="#gratia-090"></a></h2><p class="text-muted">CRAN release: 2024-03-27</p>
<div class="section level3">
<h3 id="breaking-changes-0-9-0">Breaking changes<a class="anchor" aria-label="anchor" href="#breaking-changes-0-9-0"></a></h3>
<ul><li>
<p>Many functions now return objects with different named variables. In order to avoid clashes with variable names used in user’s models or data, a period (<code>.</code>) is now being used as a prefix for generated variable names. The functions whose names have changed are: <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code>, <code><a href="../reference/fitted_values.html">fitted_values()</a></code>, <code><a href="../reference/fitted_samples.html">fitted_samples()</a></code>, <code><a href="../reference/posterior_samples.html">posterior_samples()</a></code>, <code><a href="../reference/derivatives.html">derivatives()</a></code>, <code><a href="../reference/partial_derivatives.html">partial_derivatives()</a></code>, and <code><a href="../reference/derivative_samples.html">derivative_samples()</a></code>. In addition, <code><a href="../reference/add_confint.html">add_confint()</a></code> also adds newly-named variables.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fl">1.</span> <span class="st">`</span><span class="at">est</span><span class="st">`</span> is now <span class="st">`</span><span class="at">.estimate</span><span class="st">`</span>,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fl">2.</span> <span class="st">`</span><span class="at">lower</span><span class="st">`</span> and <span class="st">`</span><span class="at">upper</span><span class="st">`</span> are now <span class="st">`</span><span class="at">.lower_ci</span><span class="st">`</span> and <span class="st">`</span><span class="at">.upper_ci</span><span class="st">`</span>,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fl">3.</span> <span class="st">`</span><span class="at">draw</span><span class="st">`</span> and <span class="st">`</span><span class="at">row</span><span class="st">`</span> and now <span class="st">`</span><span class="at">.draw</span><span class="st">`</span> and <span class="st">`</span><span class="at">.row</span><span class="st">`</span> respectively,</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fl">4.</span> <span class="st">`</span><span class="at">fitted</span><span class="st">`</span>, <span class="st">`</span><span class="at">se</span><span class="st">`</span>, <span class="st">`</span><span class="at">crit</span><span class="st">`</span> are now <span class="st">`</span><span class="at">.fitted</span><span class="st">`</span>, <span class="st">`</span><span class="at">.se</span><span class="st">`</span>, <span class="st">`</span><span class="at">.crit</span><span class="st">`</span>, respectively</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fl">5.</span> <span class="st">`</span><span class="at">smooth</span><span class="st">`</span>, <span class="st">`</span><span class="at">by</span><span class="st">`</span>, and <span class="st">`</span><span class="at">type</span><span class="st">`</span> <span class="cf">in</span> <span class="st">`</span><span class="at">smooth_estimates()</span><span class="st">`</span> are now <span class="st">`</span><span class="at">.smooth</span><span class="st">`</span>,</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>   <span class="st">`</span><span class="at">.by</span><span class="st">`</span>, <span class="st">`</span><span class="at">.type</span><span class="st">`</span>, respectively.</span></code></pre></div>
</li>
<li><p><code><a href="../reference/derivatives.html">derivatives()</a></code> and <code><a href="../reference/partial_derivatives.html">partial_derivatives()</a></code> now work more like <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code>; in place of the <code>var</code> and <code>data</code> columns, <em>gratia</em> now stores the data variables at which the derivatives were evaluated as columns in the object with their actual variable names.</p></li>
<li>
<p>The way spline-on-the-sphere (SOS) smooths (<code>bs = "sos"</code>) are plotted has changed to use <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">ggplot2::coord_sf()</a></code> instead of the previously-used <code><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">ggplot2::coord_map()</a></code>. This changed has been made as a result of <code><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_map()</a></code> being soft-deprecated (“superseded”) for a few minor versions of ggplot2 by now already, and changes to the guides system in version 3.5.0 of ggplot2.</p>
<p>The axes on plots created with <code><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_map()</a></code> never really worked correctly and changing the angle of the tick labels never worked. As <code><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_map()</a></code> is superseded, it didn’t receive the updates to the guides system and a side effect of these changes, the code that plotted SOS smooths was producing a warning with the release of ggplot2 version 3.5.0.</p>
<p>The projection settings used to draw SOS smooths was previously controlled via arguments <code>projection</code> and <code>orientation</code>. These arguments do not affect <code><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">ggplot2::coord_sf()</a></code>, Instead the projection used is controlled through new argument <code>crs</code>, which takes a PROJ string detailing the projection to use or an integer that refers to a known coordinate reference system (CRS). The default projection used is <code>+proj=ortho +lat_0=20 +lon_0=XX</code> where <code>XX</code> is the mean of the longitude coordinates of the data points.</p>
</li>
</ul><div class="section level4">
<h4 id="defunct-and-deprecated-functions-and-arguments-0-9-0">Defunct and deprecated functions and arguments<a class="anchor" aria-label="anchor" href="#defunct-and-deprecated-functions-and-arguments-0-9-0"></a></h4>
<div class="section level5">
<h5 id="defunct-0-9-0">Defunct<a class="anchor" aria-label="anchor" href="#defunct-0-9-0"></a></h5>
<ul><li>
<code><a href="../reference/evaluate_smooth.html">evaluate_smooth()</a></code> was deprecated in gratia version 0.7.0. This function and all it’s methods have been removed from the package. Use <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> instead.</li>
</ul></div>
<div class="section level5">
<h5 id="deprecated-functions-0-9-0">Deprecated functions<a class="anchor" aria-label="anchor" href="#deprecated-functions-0-9-0"></a></h5>
<p>The following functions were deprecated in version 0.9.0 of gratia. They will eventually be removed from the package as part of a clean up ahead of an eventual 1.0.0 release. These functions will become defunct by version 0.11.0 or 1.0.0, whichever is released soonest.</p>
<ul><li><p><code><a href="../reference/evaluate_parametric_term.html">evaluate_parametric_term()</a></code> has been deprecated. Use <code><a href="../reference/parametric_effects.html">parametric_effects()</a></code> instead.</p></li>
<li><p><code><a href="../reference/datagen.html">datagen()</a></code> has been deprecated. It never really did what it was originally designed to do, and has been replaced by <code><a href="../reference/data_slice.html">data_slice()</a></code>.</p></li>
</ul></div>
<div class="section level5">
<h5 id="deprecated-arguments-0-9-0">Deprecated arguments<a class="anchor" aria-label="anchor" href="#deprecated-arguments-0-9-0"></a></h5>
<p>To make functions in the package more consistent, the arguments <code>select</code>, <code>term</code>, and <code>smooth</code> are all used for the same thing and hence the latter two have been deprecated in favour of <code>select</code>. If a deprecated argument is used, a warning will be issued but the value assigned to the argument will be assigned to <code>select</code> and the function will continue.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="user-visible-changes-0-9-0">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-9-0"></a></h3>
<ul><li>
<p><code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> now uses a single call to the RNG to generate draws from the posterior of smooths. Previous to version 0.9.0, <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> would do a separate call to <code><a href="https://rdrr.io/pkg/mvnfast/man/rmvn.html" class="external-link">mvnfast::rmvn()</a></code> for each smooth. As a result, the result of a call to <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> on a model with multiple smooths will now produce different results to those generated previously. To regain the old behaviour, add <code>rng_per_smooth = TRUE</code> to the <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> call.</p>
<p>Note, however, that using per-smooth RNG calls with <code>method = "mh"</code> will be very inefficient as, with that method, posterior draws for all coefficients in the model are sampled at once. So, only use <code>rng_per_smooth = TRUE</code> with <code>method = "gaussian"</code>.</p>
</li>
<li>
<p>The output of <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> and its <code><a href="../reference/draw.html">draw()</a></code> method have changed for tensor product smooths that involve one or more 2D marginal smooths. Now, if no covariate values are supplied via the <code>data</code> argument, <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> identifies if one of the marginals is a 2d surface and allows the covariates involved in that surface to vary fastest, ahead of terms in other marginals. This change has been made as it provides a better default when nothing is provided to <code>data</code>.</p>
<p>This also affects <code><a href="../reference/draw.gam.html">draw.gam()</a></code>.</p>
</li>
<li><p><code><a href="../reference/fitted_values.html">fitted_values()</a></code> now has some level of support for location, scale, shape families. Supported families are <code><a href="https://rdrr.io/pkg/mgcv/man/gaulss.html" class="external-link">mgcv::gaulss()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/gammals.html" class="external-link">mgcv::gammals()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/gumbls.html" class="external-link">mgcv::gumbls()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/gevlss.html" class="external-link">mgcv::gevlss()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/shash.html" class="external-link">mgcv::shash()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/twlss.html" class="external-link">mgcv::twlss()</a></code>, and <code><a href="https://rdrr.io/pkg/mgcv/man/ziplss.html" class="external-link">mgcv::ziplss()</a></code>.</p></li>
<li><p><em>gratia</em> now requires <em>dplyr</em> versions &gt;= 1.1.0 and <em>tidyselect</em> &gt;= 1.2.0.</p></li>
<li><p>A new vignette <em>Posterior Simulation</em> is available, which describes how to do posterior simulation from fitted GAMs using {gratia}.</p></li>
</ul></div>
<div class="section level3">
<h3 id="new-features-0-9-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-9-0"></a></h3>
<ul><li><p>Soap film smooths using basis <code>bs = "so"</code> are now handled by <code><a href="../reference/draw.html">draw()</a></code>, <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> etc. <a href="https://github.com/gavinsimpson/gratia/issues/8" class="external-link">#8</a></p></li>
<li><p><code><a href="../reference/response_derivatives.html">response_derivatives()</a></code> is a new function for computing derivatives of the response with respect to a (continuous) focal variable. First or second order derivatives can be computed using forward, backward, or central finite differences. The uncertainty in the estimated derivative is determined using posterior sampling via <code><a href="../reference/fitted_samples.html">fitted_samples()</a></code>, and hence can be derived from a Gaussian approximation to the posterior or using a Metropolis Hastings sampler (see below.)</p></li>
<li><p><code><a href="../reference/derivative_samples.html">derivative_samples()</a></code> is the work horse function behind <code><a href="../reference/response_derivatives.html">response_derivatives()</a></code>, which computes and returns posterior draws of the derivatives of any additive combination of model terms. Requested by <a href="https://github.com/jonathanmellor" class="external-link">@jonathanmellor</a> <a href="https://github.com/gavinsimpson/gratia/issues/237" class="external-link">#237</a></p></li>
<li><p><code><a href="../reference/data_sim.html">data_sim()</a></code> can now simulate response data from gamma, Tweedie and ordered categorical distributions.</p></li>
<li><p><code><a href="../reference/data_sim.html">data_sim()</a></code> gains two new example models <code>"gwf2"</code>, simulating data only from Gu &amp; Wahba’s <em>f2</em> function, and <code>"lwf6"</code>, example function 6 from Luo &amp; Wahba (1997 JASA 92(437), 107-116).</p></li>
<li><p><code><a href="../reference/data_sim.html">data_sim()</a></code> can also simulate data for use with GAMs fitted using <code>family = gfam()</code> for grouped families where different types of data in the response are handled. <a href="https://github.com/gavinsimpson/gratia/issues/266" class="external-link">#266</a> and part of <a href="https://github.com/gavinsimpson/gratia/issues/265" class="external-link">#265</a></p></li>
<li><p><code><a href="../reference/fitted_samples.html">fitted_samples()</a></code> and <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> can now use the Metropolis Hastings sampler from <code><a href="https://rdrr.io/pkg/mgcv/man/gam.mh.html" class="external-link">mgcv::gam.mh()</a></code>, instead of a Gaussian approximation, to sample from the posterior distribution of the model or specific smooths respectively.</p></li>
<li><p><code><a href="../reference/posterior_samples.html">posterior_samples()</a></code> is a new function in the family of <code><a href="../reference/fitted_samples.html">fitted_samples()</a></code> and <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code>. <code><a href="../reference/posterior_samples.html">posterior_samples()</a></code> returns draws from the posterior distribution of the response, combining the uncertainty in the estimated expected value of the response and the dispersion of the response distribution. The difference between <code><a href="../reference/posterior_samples.html">posterior_samples()</a></code> and <code><a href="../reference/predicted_samples.html">predicted_samples()</a></code> is that the latter only includes variation due to drawing samples from the conditional distribution of the response (the uncertainty in the expected values is ignored), while the former includes both sources of uncertainty.</p></li>
<li><p><code><a href="../reference/fitted_samples.html">fitted_samples()</a></code> can new use a matrix of user-supplied posterior draws. Related to <a href="https://github.com/gavinsimpson/gratia/issues/120" class="external-link">#120</a></p></li>
<li><p><code><a href="../reference/add_fitted_samples.html">add_fitted_samples()</a></code>, <code><a href="../reference/add_fitted_samples.html">add_predicted_samples()</a></code>, <code><a href="../reference/add_fitted_samples.html">add_posterior_samples()</a></code>, and <code><a href="../reference/add_fitted_samples.html">add_smooth_samples()</a></code> are new utility functions that add the respective draws from the posterior distribution to an existing data object for the covariate values in that object: <code>obj |&gt; add_posterior_draws(model)</code>. <a href="https://github.com/gavinsimpson/gratia/issues/50" class="external-link">#50</a></p></li>
<li><p><code><a href="../reference/basis_size.html">basis_size()</a></code> is a new function to extract the basis dimension (number of basis functions) for smooths. Methods are available for objects that inherit from classes <code>"gam"</code>, <code>"gamm"</code>, and <code>"mgcv.smooth"</code> (for individual smooths).</p></li>
<li><p><code><a href="../reference/data_slice.html">data_slice()</a></code> gains a method for data frames and tibbles.</p></li>
<li><p><code><a href="../reference/typical_values.html">typical_values()</a></code> gains a method for data frames and tibbles.</p></li>
<li><p><code><a href="../reference/fitted_values.html">fitted_values()</a></code> now works with models fitted using the <code><a href="https://rdrr.io/pkg/mgcv/man/ocat.html" class="external-link">mgcv::ocat()</a></code> family. The predicted probability for each category is returned, alongside a Wald interval created using the standard error (SE) of the estimated probability. The SE and estimated probabilities are transformed to the logit (linear predictor) scale, a Wald credible interval is formed, which is then back-transformed to the response (probability) scale.</p></li>
<li><p><code><a href="../reference/fitted_values.html">fitted_values()</a></code> now works for GAMMs fitted using <code><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">mgcv::gamm()</a></code>. Fitted (predicted) values only use the GAM part of the model, and thus exclude the random effects.</p></li>
<li><p><code><a href="../reference/link.html">link()</a></code> and <code><a href="../reference/link.html">inv_link()</a></code> work for models fitted using the <code><a href="https://rdrr.io/pkg/mgcv/man/cnorm.html" class="external-link">cnorm()</a></code> family.</p></li>
<li><p>A worm plot can now be drawn in place of the QQ plot with <code><a href="../reference/appraise.html">appraise()</a></code> via new argument <code>use_worm = TRUE</code>. <a href="https://github.com/gavinsimpson/gratia/issues/62" class="external-link">#62</a></p></li>
<li><p><code><a href="../reference/smooths.html">smooths()</a></code> now works for models fitted with <code><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">mgcv::gamm()</a></code>.</p></li>
<li><p><code><a href="../reference/overview.html">overview()</a></code> now returns the basis dimension for each smooth and gains an argument <code>stars</code> which if <code>TRUE</code> add significance stars to the output plus a legend is printed in the tibble footer. Part of wish of <a href="https://github.com/noamross" class="external-link">@noamross</a> <a href="https://github.com/gavinsimpson/gratia/issues/214" class="external-link">#214</a></p></li>
<li><p>New <code><a href="../reference/add_constant.html">add_constant()</a></code> and <code><a href="../reference/transform_fun.html">transform_fun()</a></code> methods for <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code>.</p></li>
<li><p><code><a href="../reference/evenly.html">evenly()</a></code> gains arguments <code>lower</code> and <code>upper</code> to modify the lower and / or upper bound of the interval over which evenly spaced values will be generated.</p></li>
<li><p><code><a href="../reference/add_sizer.html">add_sizer()</a></code> is a new function to add information on whether the derivative of a smooth is significantly changing (where the credible interval excludes 0). Currently, methods for <code><a href="../reference/derivatives.html">derivatives()</a></code> and <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> objects are implemented. Part of request of <a href="https://github.com/asanders11" class="external-link">@asanders11</a> <a href="https://github.com/gavinsimpson/gratia/issues/117" class="external-link">#117</a></p></li>
<li><p><code><a href="../reference/draw.derivatives.html">draw.derivatives()</a></code> gains arguments <code>add_change</code> and <code>change_type</code> to allow derivatives of smooths to be plotted with indicators where the credible interval on the derivative excludes 0. Options allow for periods of decrease or increase to be differentiated via <code>change_type = "sizer"</code> instead of the default <code>change_type = "change"</code>, which emphasises either type of change in the same way. Part of wish of <a href="https://github.com/asanders11" class="external-link">@asanders11</a> <a href="https://github.com/gavinsimpson/gratia/issues/117" class="external-link">#117</a></p></li>
<li>
<p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> can now group factor by smooths for a given factor into a single panel, rather than plotting the smooths for each level in separate panels. This is achieved via new argument <code>grouped_by</code>. Requested by <a href="https://github.com/RPanczak" class="external-link">@RPanczak</a> <a href="https://github.com/gavinsimpson/gratia/issues/89" class="external-link">#89</a></p>
<p><code><a href="../reference/draw.smooth_estimates.html">draw.smooth_estimates()</a></code> can now also group factor by smooths for a given factor into a single panel.</p>
</li>
<li><p>The underlying plotting code used by <code>draw_smooth_estimates()</code> for most univariate smooths can now add change indicators to the plots of smooths if those change indicators are added to the object created by <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> using <code><a href="../reference/add_sizer.html">add_sizer()</a></code>. See the example in <code><a href="../reference/draw.smooth_estimates.html">?draw.smooth_estimates</a></code>.</p></li>
<li>
<p><code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> can, when evaluating a 3D or 4D tensor product smooth, identify if one or more 2D smooths is a marginal of the tensor product. If users do not provide covariate values at which to evaluate the smooths, <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> will focus on the 2D marginal smooth (or the first if more than one is involved in the tensor product), instead of following the ordering of the terms in the definition of the tensor product. <a href="https://github.com/gavinsimpson/gratia/issues/191" class="external-link">#191</a></p>
<p>For example, in <code>te(z, x, y, bs = c(cr, ds), d = c(1, 2))</code>, the second marginal smooth is a 2D Duchon spline of covariates <code>x</code> and <code>y</code>. Previously, <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> would have generated <code>n</code> values each for <code>z</code> and <code>x</code> and <code>n_3d</code> values for <code>y</code>, and then evaluated the tensor product at all combinations of those generated values. This would ignore the structure implicit in the tensor product, where we are likely to want to know how the surface estimated by the Duchon spline of <code>x</code> and <code>y</code> smoothly varies with <code>z</code>. Previously <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> would generate surfaces of <code>z</code> and <code>x</code>, varying by <code>y</code>. Now, <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> correctly identifies that one of the marginal smooths of the tensor product is a 2D surface and will focus on that surface varying with the other terms in the tensor product.</p>
<p>This improved behaviour is needed because in some <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam()</a></code> models it is not always possible to do the obvious thing and reorder the smooths when defining the tensor product to be <code>te(x, y, z, bs = c(ds, cr), d = c(2, 1))</code>. When <code>discrete = TRUE</code> is used with <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam()</a></code> the terms in the tensor product may get rearranged during model setup for maximum efficiency (See <em>Details</em> in <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">?mgcv::bam</a></code>).</p>
<p>Additionally, <code><a href="../reference/draw.gam.html">draw.gam()</a></code> now also works the same way.</p>
</li>
<li><p>New function <code><a href="../reference/null_deviance.html">null_deviance()</a></code> that extracts the null deviance of a fitted model.</p></li>
<li><p><code><a href="../reference/draw.html">draw()</a></code>, <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code>, <code><a href="../reference/fitted_values.html">fitted_values()</a></code>, <code><a href="../reference/data_slice.html">data_slice()</a></code>, and <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> now all work for models fitted with <code><a href="https://rdrr.io/pkg/scam/man/scam.html" class="external-link">scam::scam()</a></code>. Where it matters, current support extends only to univariate smooths.</p></li>
<li><p><code><a href="../reference/post_draws.html">generate_draws()</a></code> is a new low-level function for generating posterior draws from fitted model coefficients. <code>generate_daws()</code> is an S3 generic function so is extensible by users. Currently provides a simple interface to a simple Gaussian approximation sampler (<code><a href="../reference/gaussian_draws.html">gaussian_draws()</a></code>) and the simple Metropolis Hastings sample (<code><a href="../reference/mh_draws.html">mh_draws()</a></code>) available via <code><a href="https://rdrr.io/pkg/mgcv/man/gam.mh.html" class="external-link">mgcv::gam.mh()</a></code>. <a href="https://github.com/gavinsimpson/gratia/issues/211" class="external-link">#211</a></p></li>
<li><p><code><a href="../reference/smooth_label.html">smooth_label()</a></code> is a new function for extracting the labels ‘mgcv’ creates for smooths from the smooth object itself.</p></li>
<li><p><code><a href="../reference/penalty.html">penalty()</a></code> has a default method that works with <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">te()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/t2.html" class="external-link">t2()</a></code>, and <code><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti()</a></code>, which create a smooth specification.</p></li>
<li><p><code><a href="../reference/transform_fun.html">transform_fun()</a></code> gains argument <code>constant</code> to allow for the addition of a constant value to objects (e.g. the estimate and confidence interval). This enables a single <code>obj |&gt; transform_fun(fun = exp, constant = 5)</code> instead of separate calls to <code><a href="../reference/add_constant.html">add_constant()</a></code> and then <code><a href="../reference/transform_fun.html">transform_fun()</a></code>. Part of the discussion of <a href="https://github.com/gavinsimpson/gratia/issues/79" class="external-link">#79</a></p></li>
<li><p><code><a href="../reference/model_constant.html">model_constant()</a></code> is a new function that simply extracts the first coefficient from the estimated model.</p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-9-0">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-9-0"></a></h3>
<ul><li>
<p><code><a href="../reference/link.html">link()</a></code>, <code><a href="../reference/link.html">inv_link()</a></code>, and related family functions for the <code><a href="https://rdrr.io/pkg/mgcv/man/ocat.html" class="external-link">ocat()</a></code> weren’t correctly identifying the family name and as a result would throw an error even when passed an object of the correct family.</p>
<p><code><a href="../reference/link.html">link()</a></code> and <code><a href="../reference/link.html">inv_link()</a></code> now work correctly for the <code><a href="https://rdrr.io/pkg/mgcv/man/Beta.html" class="external-link">betar()</a></code> family in a fitted GAM.</p>
</li>
<li><p>The <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> method for <code><a href="../reference/lp_matrix.html">lp_matrix()</a></code> now converts the matrix to a data frame before conversion to a tibble. This makes more sense as it results in more typical behaviour as the columns of the printed object are doubles.</p></li>
<li><p>Constrained factor smooths (<code>bs = "sz"</code>) where the factor is not the first variable mentioned in the smooth (i.e. <code>s(x, f, bs = "sz")</code> for continuous <code>x</code> and factor <code>f</code>) are now plottable with <code><a href="../reference/draw.html">draw()</a></code>. <a href="https://github.com/gavinsimpson/gratia/issues/208" class="external-link">#208</a></p></li>
<li><p><code><a href="../reference/parametric_effects.html">parametric_effects()</a></code> was unable to handle special parametric terms like <code>poly(x)</code> or <code>log(x)</code> in formulas. Reported by <a href="https://github.com/fhui28" class="external-link">@fhui28</a> <a href="https://github.com/gavinsimpson/gratia/issues/212" class="external-link">#212</a></p></li>
<li><p><code><a href="../reference/parametric_effects.html">parametric_effects()</a></code> now works better for location, scale, shape models. Reported by <a href="https://github.com/pboesu" class="external-link">@pboesu</a> <a href="https://github.com/gavinsimpson/gratia/issues/45" class="external-link">#45</a></p></li>
<li><p><code>parametric_effects</code> now works when there are missing values in one or more variables used in a fitted GAM. <a href="https://github.com/gavinsimpson/gratia/issues/219" class="external-link">#219</a></p></li>
<li><p><code><a href="../reference/response_derivatives.html">response_derivatives()</a></code> was incorrectly using <code>.data</code> with <em>tidyselect</em> selectors.</p></li>
<li><p><code><a href="../reference/typical_values.html">typical_values()</a></code> could not handle logical variables in a GAM fit as mgcv stores these as numerics in the <code>var.summary</code>. This affected <code><a href="../reference/evenly.html">evenly()</a></code> and <code><a href="../reference/data_slice.html">data_slice()</a></code>. <a href="https://github.com/gavinsimpson/gratia/issues/222" class="external-link">#222</a></p></li>
<li><p><code><a href="../reference/parametric_effects.html">parametric_effects()</a></code> would fail when two or more ordered factors were in the model. Reported by <a href="https://github.com/dsmi31" class="external-link">@dsmi31</a> <a href="https://github.com/gavinsimpson/gratia/issues/221" class="external-link">#221</a></p></li>
<li><p>Continuous by smooths were being evaluated with the median value of the <code>by</code> variable instead of a value of 1. <a href="https://github.com/gavinsimpson/gratia/issues/224" class="external-link">#224</a></p></li>
<li><p><code><a href="../reference/fitted_samples.html">fitted_samples()</a></code> (and hence <code><a href="../reference/posterior_samples.html">posterior_samples()</a></code>) now handles models with offset terms in the formula. Offset terms supplied via the <code>offset</code> argument are ignored by <code>mgcv:::predict.gam()</code> and hence are ignored also by <code>gratia</code>. Reported by <a href="https://github.com/jonathonmellor" class="external-link">@jonathonmellor</a> <a href="https://github.com/gavinsimpson/gratia/issues/231" class="external-link">#231</a> <a href="https://github.com/gavinsimpson/gratia/issues/233" class="external-link">#233</a></p></li>
<li><p><code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> would fail on a <code>"fs"</code> smooth when a multivariate base smoother was used <em>and</em> the factor was not the last variable specified in the definition of the smooth: <code>s(x1, x2, f, bs = "fs", xt = list(bs = "ds"))</code> would work, but <code>s(f, x1, x2, bs = "fs", xt = list(bs = "ds"))</code> (or any ordering of variables that places the factor not last) would emit an obscure error. The ordering of the terms involved in the smooth now doesn’t matter. Reported by <a href="https://github.com/chrisaak" class="external-link">@chrisaak</a> <a href="https://github.com/gavinsimpson/gratia/issues/249" class="external-link">#249</a>.</p></li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> would fail when plotting a multivariate base smoother used in an <code>"sz"</code> smooth. Now, this use case is identified and a message printed indicating that (currently) gratia doesn’t know how to plot such a smooth. Reported by <a href="https://github.com/chrisaak" class="external-link">@chrisaak</a> <a href="https://github.com/gavinsimpson/gratia/issues/249" class="external-link">#249</a>.</p></li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> would fail when plotting a multivariate base smoother used in an <code>"fs"</code> smooth. Now, this use case is identified and a message printed indicating that (currently) gratia doesn’t know how to plot such a smooth. Reported by <a href="https://github.com/chrisaak" class="external-link">@chrisaak</a> <a href="https://github.com/gavinsimpson/gratia/issues/249" class="external-link">#249</a>.</p></li>
<li><p><code><a href="../reference/derivative_samples.html">derivative_samples()</a></code> would fail with <code>order = 2</code> and was only computing forward finite differences, regardless of <code>type</code> for <code>order = 1</code>. Partly reported by <a href="https://github.com/samlipworth" class="external-link">@samlipworth</a> <a href="https://github.com/gavinsimpson/gratia/issues/251" class="external-link">#251</a>.</p></li>
<li><p>The <code><a href="../reference/draw.html">draw()</a></code> method for <code><a href="../reference/penalty.html">penalty()</a></code> was normalizing the penalty to the range 0–1, not the claimed and documented -1–1 with argument <code>normalize = TRUE</code>. This is now fixed.</p></li>
<li><p><code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> was failing when <code>data</code> was supplied that contained more variables than were used in the smooth that was being sampled. Hence this generally fail unless a single smooth was being sampled from or the model contained only a single smooth. The function never intended to retain all the variables in <code>data</code> but was written in such a way that it would fail when relocating the data columns to the end of the posterior sampling object. <a href="https://github.com/gavinsimpson/gratia/issues/255" class="external-link">#255</a></p></li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> and <code><a href="../reference/draw.smooth_estimates.html">draw.smooth_estimates()</a></code> would fail when plotting a univariate tensor product smooth (e.g. <code>te(x)</code>, <code>ti(x)</code>, or <code><a href="https://rdrr.io/pkg/mgcv/man/t2.html" class="external-link">t2()</a></code>). Reported by <a href="https://github.com/wStockhausen" class="external-link">@wStockhausen</a> <a href="https://github.com/gavinsimpson/gratia/issues/260" class="external-link">#260</a></p></li>
<li><p><code>plot.smooth()</code> was not printing the factor level in subtitles for ordered factor by smooths.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.8.2" id="gratia-082">gratia 0.8.2<a class="anchor" aria-label="anchor" href="#gratia-082"></a></h2><p class="text-muted">CRAN release: 2024-01-09</p>
<ul><li>Small fixes for CRAN.</li>
</ul></div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.8.1" id="gratia-081">gratia 0.8.1<a class="anchor" aria-label="anchor" href="#gratia-081"></a></h2><p class="text-muted">CRAN release: 2023-02-02</p>
<div class="section level3">
<h3 id="user-visible-changes-0-8-1">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-8-1"></a></h3>
<ul><li><p><code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> now returns objects with variables involved in smooths that have their correct name. Previously variables were named <code>.x1</code>, <code>.x2</code>, etc. Fixing <a href="https://github.com/gavinsimpson/gratia/issues/126" class="external-link">#126</a> and improving compatibility with <code><a href="../reference/compare_smooths.html">compare_smooths()</a></code> and <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> allowed the variables to be named correctly.</p></li>
<li><p><em>gratia</em> now depends on version 1.8-41 or later of the <em>mgcv</em> package.</p></li>
</ul></div>
<div class="section level3">
<h3 id="new-features-0-8-1">New features<a class="anchor" aria-label="anchor" href="#new-features-0-8-1"></a></h3>
<ul><li>
<code><a href="../reference/draw.gam.html">draw.gam()</a></code> can now handle tensor products that include a marginal random effect smooth. Beware plotting such smooths if there are many levels, however, as a separate surface plot will be produced for each level.</li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-8-1">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-8-1"></a></h3>
<ul><li><p>Additional fixes for changes in dplyr 1.1.0.</p></li>
<li><p><code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> now works when sampling from posteriors of multiple smooths with different dimension. <a href="https://github.com/gavinsimpson/gratia/issues/126" class="external-link">#126</a> reported by <a href="https://github.com/Aariq" class="external-link">@Aariq</a></p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.8.0" id="gratia-080">gratia 0.8.0<a class="anchor" aria-label="anchor" href="#gratia-080"></a></h2>
<div class="section level3">
<h3 id="user-visible-changes-0-8-0">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-8-0"></a></h3>
<ul><li><p>{gratia} now depends on R version 4.1 or later.</p></li>
<li><p>A new vignette “Data slices” is supplied with {gratia}.</p></li>
<li>
<p>Functions in {gratia} have harmonised to use an argument named <code>data</code> instead of <code>newdata</code> for passing new data at which to evaluate features of smooths. A message will be printed if <code>newdata</code> is used from now on. Existing code does not need to be changed as <code>data</code> takes its value from <code>newdata</code>.</p>
<p>Note that due to the way <code>...</code> is handled in R, if your R script uses the <code>data</code> argument, <em>and</em> is run with versions of gratia prior to 8.0 (when released; 0.7.3.8 if using the development version) the user-supplied data will be silently ignored. As such, scripts using <code>data</code> should check that the installed version of gratia is &gt;= 0.8 and package developers should update to depend on versions &gt;= 0.8 by using <code>gratia (&gt;= 0.8)</code> in <code>DESCRIPTION</code>.</p>
</li>
<li><p>The order of the plots of smooths has changed in <code><a href="../reference/draw.gam.html">draw.gam()</a></code> so that they again match the order in which smooths were specified in the model formula. See <em>Bug Fixes</em> below for more detail or <a href="https://github.com/gavinsimpson/gratia/issues/154" class="external-link">#154</a>.</p></li>
</ul></div>
<div class="section level3">
<h3 id="new-features-0-8-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-8-0"></a></h3>
<ul><li><p>Added basic support for GAMLSS (distributional GAMs) fitted with the <code><a href="https://rdrr.io/pkg/GJRM/man/gamlss.html" class="external-link">gamlss()</a></code> function from package GJRM. Support is currently restricted to a <code><a href="../reference/draw.html">draw()</a></code> method.</p></li>
<li>
<p><code><a href="../reference/difference_smooths.html">difference_smooths()</a></code> can now include the group means in the difference, which many users expected. To include the group means use <code>group_means = TRUE</code> in the function call, e.g. <code>difference_smooths(model, smooth = "s(x)", group_means = TRUE</code>). Note: this function still differs from <code>plot_diff()</code> in package <em>itsadug</em>, which essentially computes differences of model predictions. The main practical difference is that other effects beyond the factor by smooth, including random effects, may be included with <code>plot_diff()</code>.</p>
<p>This implements the main wish of <a href="https://github.com/gavinsimpson/gratia/issues/108" class="external-link">#108</a> (<a href="https://github.com/dinga92" class="external-link">@dinga92</a>) and <a href="https://github.com/gavinsimpson/gratia/issues/143" class="external-link">#143</a> (<a href="https://github.com/mbolyanatz" class="external-link">@mbolyanatz</a>) despite my protestations that this was complicated in some cases (it isn’t; the complexity just cancels out.)</p>
</li>
<li>
<p><code><a href="../reference/data_slice.html">data_slice()</a></code> has been totally revised. Now, the user provides the values for the variables they want in the slice and any variables in the model that are not specified will be held at typical values (i.e. the value of the observation that is closest to the median for numeric variables, or the modal factor level.)</p>
<p>Data slices are now produced by passing <code>name</code> = <code>value</code> pairs for the variables and their values that you want to appear in the slice. For example</p>
<pre><code><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">fac</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/data_slice.html">data_slice</a></span><span class="op">(</span><span class="va">model</span>, x1 <span class="op">=</span> <span class="fu"><a href="../reference/evenly.html">evenly</a></span><span class="op">(</span><span class="va">x1</span>, n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span><span class="op">)</span></span></code></pre>
<p>The <code>value</code> in the pair can be an expression that will be looked up (evaluated) in the <code>data</code> argument or the model frame of the fitted model (the default). In the above example, the resulting slice will be a data frame of 100 observations, comprising <code>x1</code>, which is a vector of 100 values spread evenly over the range of <code>x1</code>, a constant value of the mean of <code>x2</code> for the <code>x2</code> variable, and a constant factor level, the model class of <code>fac</code>, for the <code>fac</code> variable of the model.</p>
</li>
<li><p><code><a href="../reference/partial_derivatives.html">partial_derivatives()</a></code> is a new function for computing partial derivatives of multivariate smooths (e.g. <code>s(x,z)</code>, <code>te(x,z)</code>) with respect to one of the margins of the smooth. Multivariate smooths of any dimension are handled, but only one of the dimensions is allowed to vary. Partial derivatives are estimated using the method of finite differences, with forward, backward, and central finite differences available. Requested by <a href="https://github.com/noamross" class="external-link">@noamross</a> <a href="https://github.com/gavinsimpson/gratia/issues/101" class="external-link">#101</a></p></li>
<li><p><code><a href="../reference/overview.html">overview()</a></code> provides a simple overview of model terms for fitted GAMs.</p></li>
<li><p>The new <code>bs = "sz"</code> basis that was released with <em>mgcv</em> version 1.18-41 is now supported in <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code>, <code><a href="../reference/draw.gam.html">draw.gam()</a></code>, and <code><a href="../reference/draw.smooth_estimates.html">draw.smooth_estimates()</a></code> and this basis has its own unique plotting method. <a href="https://github.com/gavinsimpson/gratia/issues/202" class="external-link">#202</a></p></li>
<li>
<p><code><a href="../reference/basis.html">basis()</a></code> now has a method for fitted GAM(M)s which can extract the estimated basis from the model and plot it, using the estimated coefficients for the smooth to weight the basis. <a href="https://github.com/gavinsimpson/gratia/issues/137" class="external-link">#137</a></p>
<p>There is also a new <code><a href="../reference/draw.basis.html">draw.basis()</a></code> method for plotting the results of a call to <code><a href="../reference/basis.html">basis()</a></code>. This method can now also handle bivariate bases.</p>
<p><code><a href="../reference/tidy_basis.html">tidy_basis()</a></code> is a lower level function that does the heavy lifting in <code><a href="../reference/basis.html">basis()</a></code>, and is now exported. <code><a href="../reference/tidy_basis.html">tidy_basis()</a></code> returns a tidy representation of a basis supplied as an object inheriting from class <code>"mgcv.smooth"</code>. These objects are returned in the <code>$smooth</code> component of a fitted GAM(M) model.</p>
</li>
<li><p><code><a href="../reference/lp_matrix.html">lp_matrix()</a></code> is a new utility function to quickly return the linear predictor matrix for an estimated model. It is a wrapper to <code>predict(..., type = "lpmatrix")</code></p></li>
<li><p><code><a href="../reference/evenly.html">evenly()</a></code> is a synonym for <code><a href="../reference/evenly.html">seq_min_max()</a></code> and is preferred going forward. Gains argument <code>by</code> to produce sequences over a covariate that increment in units of <code>by</code>.</p></li>
<li><p><code><a href="../reference/ref_level.html">ref_level()</a></code> and <code><a href="../reference/ref_level.html">level()</a></code> are new utility functions for extracting the reference or a specific level of a factor respectively. These will be most useful when specifying covariate values to condition on in a data slice.</p></li>
<li><p><code><a href="../reference/model_vars.html">model_vars()</a></code> is a new, public facing way of returning a vector of variables that are used in a model.</p></li>
<li><p><code><a href="../reference/difference_smooths.html">difference_smooths()</a></code> will now use the user-supplied data as points at which to evaluate a pair of smooths. Also note that the argument <code>newdata</code> has been renamed <code>data</code>. <a href="https://github.com/gavinsimpson/gratia/issues/175" class="external-link">#175</a></p></li>
<li><p>The <code><a href="../reference/draw.html">draw()</a></code> method for <code><a href="../reference/difference_smooths.html">difference_smooths()</a></code> now uses better labels for plot titles to avoid long labels with even modest factor levels.</p></li>
<li><p><code><a href="../reference/derivatives.html">derivatives()</a></code> now works for factor-smooth interaction (<code>"fs"</code>) smooths.</p></li>
<li><p><code><a href="../reference/draw.html">draw()</a></code> methods now allow the angle of tick labels on the x axis of plots to be rotated using argument <code>angle</code>. Requested by <a href="https://github.com/tamas-ferenci" class="external-link">@tamas-ferenci</a> <a href="https://github.com/gavinsimpson/gratia/issues/87" class="external-link">#87</a></p></li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> and related functions (<code><a href="../reference/draw.parametric_effects.html">draw.parametric_effects()</a></code>, <code><a href="../reference/draw.smooth_estimates.html">draw.smooth_estimates()</a></code>) now add the basis to the plot using a caption. <a href="https://github.com/gavinsimpson/gratia/issues/155" class="external-link">#155</a></p></li>
<li><p><code><a href="../reference/smooth_coefs.html">smooth_coefs()</a></code> is a new utility function for extracting the coefficients for a particular smooth from a fitted model. <code><a href="../reference/smooth_coef_indices.html">smooth_coef_indices()</a></code> is an associated function that returns the indices (positions) in the vector of model coefficients (returned by <code>coef(gam_model)</code>) of those coefficients that pertain to the stated smooth.</p></li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> now better handles patchworks of plots where one or more of those plots has fixed aspect ratios. <a href="https://github.com/gavinsimpson/gratia/issues/190" class="external-link">#190</a></p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-8-0">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-8-0"></a></h3>
<ul><li><p><code>draw.posterior_smooths</code> now plots posterior samples with a fixed aspect ratio if the smooth is isotropic. <a href="https://github.com/gavinsimpson/gratia/issues/148" class="external-link">#148</a></p></li>
<li><p><code><a href="../reference/derivatives.html">derivatives()</a></code> now ignores random effect smooths (for which derivatives don’t make sense anyway). <a href="https://github.com/gavinsimpson/gratia/issues/168" class="external-link">#168</a></p></li>
<li><p><code>confint.gam(...., method = "simultaneous")</code> now works with factor by smooths where <code>parm</code> is passed the full name of a specific smooth <code>s(x)faclevel</code>.</p></li>
<li><p>The order of plots produced by <code><a href="../reference/draw.gam.html">gratia::draw.gam()</a></code> again matches the order in which the smooths entered the model formula. Recent changes to the internals of <code><a href="../reference/draw.gam.html">gratia::draw.gam()</a></code> when the switch to <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> was undertaken lead to a change in behaviour resulting from the use of <code><a href="https://dplyr.tidyverse.org/reference/group_split.html" class="external-link">dplyr::group_split()</a></code>, and it’s coercion internally of a character vector to a factor. This factor is now created explicitly, and the levels set to the correct order. <a href="https://github.com/gavinsimpson/gratia/issues/154" class="external-link">#154</a></p></li>
<li><p>Setting the <code>dist</code> argument to set response or smooth values to <code>NA</code> if they lay too far from the support of the data in multivariate smooths, this would lead an incorrect scale for the response guide. This is now fixed. <a href="https://github.com/gavinsimpson/gratia/issues/193" class="external-link">#193</a></p></li>
<li><p>Argument <code>fun</code> to <code><a href="../reference/draw.gam.html">draw.gam()</a></code> was not being applied to any parametric terms. Reported by <a href="https://github.com/grasshoppermouse" class="external-link">@grasshoppermouse</a> <a href="https://github.com/gavinsimpson/gratia/issues/195" class="external-link">#195</a></p></li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> was adding the uncertainty for all linear predictors to smooths when <code>overall_uncertainty = TRUE</code> was used. Now <code><a href="../reference/draw.gam.html">draw.gam()</a></code> only includes the uncertainty for those linear predictors in which a smooth takes part. <a href="https://github.com/gavinsimpson/gratia/issues/158" class="external-link">#158</a></p></li>
<li><p><code><a href="../reference/partial_derivatives.html">partial_derivatives()</a></code> works when provided with a single data point at which to evaluate the derivative. <a href="https://github.com/gavinsimpson/gratia/issues/199" class="external-link">#199</a></p></li>
<li><p><code><a href="../reference/transform_fun.html">transform_fun.smooth_estimates()</a></code> was addressing the wrong variable names when trying to transform the confidence interval. <a href="https://github.com/gavinsimpson/gratia/issues/201" class="external-link">#201</a></p></li>
<li><p><code><a href="../reference/data_slice.html">data_slice()</a></code> doesn’t fail with an error when used with a model that contains an offset term. <a href="https://github.com/gavinsimpson/gratia/issues/198" class="external-link">#198</a></p></li>
<li><p><code><a href="../reference/confint.gam.html">confint.gam()</a></code> no longer uses <code><a href="../reference/evaluate_smooth.html">evaluate_smooth()</a></code>, which is soft deprecated. <a href="https://github.com/gavinsimpson/gratia/issues/167" class="external-link">#167</a></p></li>
<li><p><code><a href="../reference/qq_plot.html">qq_plot()</a></code> and <code><a href="../reference/worm_plot.html">worm_plot()</a></code> could compute the wrong deviance residuals used to generate the theoretical quantiles for some of the more exotic families (distributions) available in <em>mgcv</em>. This also affected <code><a href="../reference/appraise.html">appraise()</a></code> but only for the QQ plot; the residuals shown in the other plots and the deviance residuals shown on the y-axis of the QQ plot were correct. Only the generation of the reference intervals/quantiles was affected.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.3" id="gratia-073">gratia 0.7.3<a class="anchor" aria-label="anchor" href="#gratia-073"></a></h2><p class="text-muted">CRAN release: 2022-05-09</p>
<div class="section level3">
<h3 id="user-visible-changes-0-7-3">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-7-3"></a></h3>
<ul><li>Plots of smooths now use “Partial effect” for the y-axis label in place of “Effect”, to better indicate what is displayed.</li>
</ul></div>
<div class="section level3">
<h3 id="new-features-0-7-3">New features<a class="anchor" aria-label="anchor" href="#new-features-0-7-3"></a></h3>
<ul><li><p><code><a href="../reference/confint.fderiv.html">confint.fderiv()</a></code> and <code><a href="../reference/confint.gam.html">confint.gam()</a></code> now return their results as a tibble instead of a common-or-garden data frame. The latter mostly already did this.</p></li>
<li><p>Examples for <code><a href="../reference/confint.fderiv.html">confint.fderiv()</a></code> and <code><a href="../reference/confint.gam.html">confint.gam()</a></code> were reworked, in part to remove some inconsistent output in the examples when run on M1 macs.</p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-7-3">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-7-3"></a></h3>
<ul><li>
<code><a href="../reference/compare_smooths.html">compare_smooths()</a></code> failed when passed non-standard model “names” like <code>compare_smooths(m_gam, m_gamm$gam)</code> or <code>compare_smooths(l[[1]], l[[2]])</code> even if the evaluated objects were valid GAM(M) models. Reported by Andrew Irwin <a href="https://github.com/gavinsimpson/gratia/issues/150" class="external-link">#150</a></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.2" id="gratia-072">gratia 0.7.2<a class="anchor" aria-label="anchor" href="#gratia-072"></a></h2><p class="text-muted">CRAN release: 2022-03-17</p>
<div class="section level3">
<h3 id="new-features-0-7-2">New features<a class="anchor" aria-label="anchor" href="#new-features-0-7-2"></a></h3>
<ul><li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> and <code><a href="../reference/draw.smooth_estimates.html">draw.smooth_estimates()</a></code> can now handle splines on the sphere (<code>s(lat, long, bs = "sos")</code>) with special plotting methods using <code><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">ggplot2::coord_map()</a></code> to handle the projection to spherical coordinates. An orthographic projection is used by default, with an essentially arbitrary (and northern hemisphere-centric) default for the orientation of the view.</p></li>
<li><p><code><a href="../reference/fitted_values.html">fitted_values()</a></code> insures that <code>data</code> (and hence the returned object) is a tibble rather than a common or garden data frame.</p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-7-2">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-7-2"></a></h3>
<ul><li><p><code>draw.posterior_smooths()</code> was redundantly plotting duplicate data in the rug plot. Now only the unique set of covariate values are used for drawing the rug.</p></li>
<li><p><code><a href="../reference/data_sim.html">data_sim()</a></code> was not passing the <code>scale</code> argument in the bivariate example setting (<code>"eg2"</code>).</p></li>
<li><p><code><a href="../reference/draw.html">draw()</a></code> methods for <code><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">gamm()</a></code> and <code><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4::gamm4()</a></code> fits were not passing arguments on to <code><a href="../reference/draw.gam.html">draw.gam()</a></code>.</p></li>
<li><p><code><a href="../reference/draw.smooth_estimates.html">draw.smooth_estimates()</a></code> would produce a subtitle with data for a continuous by smooth as if it were a factor by smooth. Now the subtitle only contains the name of the continuous by variable.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.1" id="gratia-071">gratia 0.7.1<a class="anchor" aria-label="anchor" href="#gratia-071"></a></h2>
<p>Due to an issue with the size of the package source tarball, which wasn’t discovered until after submission to CRAN, 0.7.1 was never released.</p>
<div class="section level3">
<h3 id="new-features-0-7-1">New features<a class="anchor" aria-label="anchor" href="#new-features-0-7-1"></a></h3>
<ul><li>
<p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> and <code><a href="../reference/draw.smooth_estimates.html">draw.smooth_estimates()</a></code>: {gratia} can now handle smooths of 3 or 4 covariates when plotting. For smooths of 3 covariates, the third covariate is handled with <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">ggplot2::facet_wrap()</a></code> and a set (default <code>n</code> = 16) of small multiples is drawn, each a 2d surface evaluated at the specified value of the third covariate. For smooths of 4 covariates, <code><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">ggplot2::facet_grid()</a></code> is used to draw the small multiples, with the default producing 4 rows by 4 columns of plots at the specific values of the third and fourth covariates. The number of small multiples produced is controlled by new arguments <code>n_3d</code> (default = <code>n_3d = 16</code>) and <code>n_4d</code> (default <code>n_4d = 4</code>, yielding <code>n_4d * n_4d</code> = 16 facets) respectively.</p>
<p>This only affects plotting; <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> has been able to handle smooths of any number of covariates for a while.</p>
<p>When handling higher-dimensional smooths, actually drawing the plots on the default device can be slow, especially with the default value of <code>n = 100</code> (which for 3D or 4D smooths would result in 160,000 data points being plotted). As such it is recommended that you reduce <code>n</code> to a smaller value: <code>n = 50</code> is a reasonable compromise of resolution and speed.</p>
</li>
<li><p><code><a href="../reference/model_concurvity.html">model_concurvity()</a></code> returns concurvity measures from <code><a href="https://rdrr.io/pkg/mgcv/man/concurvity.html" class="external-link">mgcv::concurvity()</a></code> for estimated GAMs in a tidy format. The synonym <code><a href="../reference/model_concurvity.html">concrvity()</a></code> is also provided. A <code><a href="../reference/draw.html">draw()</a></code> method is provided which produces a bar plot or a heatmap of the concurvity values depending on whether the overall concurvity of each smooth or the pairwise concurvity of each smooth in the model is requested.</p></li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> gains argument <code>resid_col = "steelblue3"</code> that allows the colour of the partial residuals (if plotted) to be changed.</p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-7-1">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-7-1"></a></h3>
<ul><li><p><code><a href="../reference/edf.html">model_edf()</a></code> was not using the <code>type</code> argument. As a result it only ever returned the default EDF type.</p></li>
<li><p><code><a href="../reference/add_constant.html">add_constant()</a></code> methods weren’t applying the constant to all the required variables.</p></li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code>, <code><a href="../reference/draw.parametric_effects.html">draw.parametric_effects()</a></code> now actually work for a model with only parametric effects. <a href="https://github.com/gavinsimpson/gratia/issues/142" class="external-link">#142</a> Reported by <a href="https://github.com/Nelson-Gon" class="external-link">@Nelson-Gon</a></p></li>
<li><p><code><a href="../reference/parametric_effects.html">parametric_effects()</a></code> would fail for a model with only parametric terms because <code><a href="https://rdrr.io/pkg/mgcv/man/predict.gam.html" class="external-link">predict.gam()</a></code> returns empty arrays when passed <code>exclude = character(0)</code>.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.7.0" id="gratia-070">gratia 0.7.0<a class="anchor" aria-label="anchor" href="#gratia-070"></a></h2><p class="text-muted">CRAN release: 2022-02-07</p>
<div class="section level3">
<h3 id="major-changes-0-7-0">Major changes<a class="anchor" aria-label="anchor" href="#major-changes-0-7-0"></a></h3>
<ul><li>
<p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> now uses <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> internally and consequently uses its <code><a href="../reference/draw.html">draw()</a></code> method and underlying plotting code. This has simplified the code compared to <code><a href="../reference/evaluate_smooth.html">evaluate_smooth()</a></code> and its methods, which will allow for future development and addition of features more easily than if <code><a href="../reference/evaluate_smooth.html">evaluate_smooth()</a></code> had been retained.</p>
<p>Similarly, <code>evaluate_parametric_terms()</code> is now deprecated in favour of <code><a href="../reference/parametric_effects.html">parametric_effects()</a></code>, which is also used internally by <code><a href="../reference/draw.gam.html">draw.gam()</a></code> if parametric terms are present in the model (and <code>parametric = TRUE</code>).</p>
<p>While a lot of code has been reused so differences between plots as a result of this change should be minimal, some corner cases may have been missed. File an Issue if you notice something that has changed that you think shouldn’t.</p>
</li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> now plots 2D isotropic smooths (TPRS and Duchon splines) with equally-scaled x and y coordinates using <code>coord_equal(ratio = 1)</code>. Alignment of these plots will be a little different now when plotting models with multiple smooths. See Issue <a href="https://github.com/gavinsimpson/gratia/issues/81" class="external-link">#81</a>.</p></li>
</ul><div class="section level4">
<h4 id="deprecated-functions-0-7-0">Deprecated functions<a class="anchor" aria-label="anchor" href="#deprecated-functions-0-7-0"></a></h4>
<p>From version 0.7.0, the following functions are considered deprecated and their use is discouraged:</p>
<ul><li>
<code><a href="../reference/fderiv.html">fderiv()</a></code> is <em>soft</em>-deprecated in favour of <code><a href="../reference/derivatives.html">derivatives()</a></code>,</li>
<li>
<code><a href="../reference/evaluate_smooth.html">evaluate_smooth()</a></code> is <em>soft</em>-deprecated in favour of <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code>,</li>
<li>
<code><a href="../reference/evaluate_parametric_term.html">evaluate_parametric_term()</a></code> is <em>soft</em>-deprecated in favour of <code><a href="../reference/parametric_effects.html">parametric_effects()</a></code>.</li>
</ul><p>The first call to one of these functions will generate a warning, pointing to the newer, alternative, function. It is safe to ignore these warnings, but these deprecated functions will no longer receive updates and are thus at risk of being removed from the package at some future date. The newer alternatives can handle more types of models and smooths, especially so in the case of <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="new-features-0-7-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-7-0"></a></h3>
<ul><li>
<p><code><a href="../reference/fitted_values.html">fitted_values()</a></code> provides a tidy wrapper around <code><a href="https://rdrr.io/pkg/mgcv/man/predict.gam.html" class="external-link">predict.gam()</a></code> for generating fitted values from the model. New covariate values can be provided via argument <code>data</code>. A credible interval on the fitted values is returned, and values can be on the link (linear predictor) or response scale.</p>
<p>Note that this function returns expected values of the response. Hence, “fitted values” is used instead of “predictions” in the case of new covariate values to differentiate these values from the case of generating new response values from a fitted model.</p>
</li>
<li><p><code><a href="../reference/rootogram.html">rootogram()</a></code> and its <code><a href="../reference/draw.html">draw()</a></code> method produce rootograms as diagnostic plots for fitted models. Currently only for models fitted with <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/negbin.html" class="external-link">nb()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/negbin.html" class="external-link">negbin()</a></code>, <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian()</a></code> families.</p></li>
<li>
<p>New helper functions <code><a href="../reference/typical_values.html">typical_values()</a></code>, <code><a href="../reference/factor_combos.html">factor_combos()</a></code> and <code><a href="../reference/data_combos.html">data_combos()</a></code> for quickly creating data sets for producing predictions from fitted models where some covariates are fixed at come typical or representative values.</p>
<p><code><a href="../reference/typical_values.html">typical_values()</a></code> is a new helper function to return typical values for the covariates of a fitted model. It returns the value of the observation closest to the median for numerical covariates or the modal level of a factor while preserving the levels of that factor. <code><a href="../reference/typical_values.html">typical_values()</a></code> is useful in preparing data slices or scenarios for which fitted values from the estimated model are required.</p>
<p><code><a href="../reference/factor_combos.html">factor_combos()</a></code> extracts and returns the combinations of levels of factors found in data used to fit a model. Unlike <code><a href="../reference/typical_values.html">typical_values()</a></code>, <code><a href="../reference/factor_combos.html">factor_combos()</a></code> returns all the combinations of factor levels observed in the data, not just the modal level. Optionally, all combinations of factor levels can be returned, not just those in the observed data.</p>
<p><code><a href="../reference/data_combos.html">data_combos()</a></code> combines returns the factor data from <code><a href="../reference/factor_combos.html">factor_combos()</a></code> plus the typical values of numerical covariates. This is useful if you want to generate predictions from the model for each combination of factor terms while holding any continuous covariates at their median values.</p>
</li>
<li><p><code><a href="../reference/nb_theta.html">nb_theta()</a></code> is a new extractor function that returns the theta parameter of a fitted negative binomial GAM (families <code><a href="https://rdrr.io/pkg/mgcv/man/negbin.html" class="external-link">nb()</a></code> or <code><a href="https://rdrr.io/pkg/mgcv/man/negbin.html" class="external-link">negbin()</a></code>). Additionally, <code><a href="../reference/theta.html">theta()</a></code> and <code><a href="../reference/has_theta.html">has_theta()</a></code> provide additional functionality. <code><a href="../reference/theta.html">theta()</a></code> is an experimental function for extracting any additional parameters from the model or family. <code><a href="../reference/has_theta.html">has_theta()</a></code> is useful for checking if any additional parameters are available from the family or model.</p></li>
<li><p><code><a href="../reference/edf.html">edf()</a></code> extracts the effective degrees of freedom (EDF) of a fitted model or a specific smooth in the model. Various forms for the EDF can be extracted.</p></li>
<li><p><code><a href="../reference/edf.html">model_edf()</a></code> returns the EDF of the overall model. If supplied with multiple models, the EDFs of each model are returned for comparison.</p></li>
<li>
<p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> can now show a “rug” plot on a bivariate smooth by drawing small points with high transparency over the smooth surface at the data coordinates.</p>
<p>In addition, the rugs on plots of factor by smooths now show the locations of covariate values for the specific level of the factor and not over all levels. This better reflects what data were used to estimate the smooth, even though the basis for each smooth was set up using all of the covariate locations.</p>
</li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> and <code><a href="../reference/draw.smooth_estimates.html">draw.smooth_estimates()</a></code> now allow some aspects of the plot to be changed: the fill (but not colour) and alpha attributes of the credible interval, and the line colour for the smooth can now be specified using arguments <code>ci_col</code>, <code>ci_alpha</code>, and <code>smooth_col</code> respectively.</p></li>
<li><p>Partial residuals can now be plotted on factor by smooths. To allow this, the partial residuals are filtered so that only residuals associated with a particular level’s smooth are drawn on the plot of the smooth.</p></li>
<li><p><code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> uses <code><a href="../reference/check_user_select_smooths.html">check_user_select_smooths()</a></code> to handle user-specified selection of smooth terms. As such it is more flexible than previously, and allows for easier selection of smooths to evaluate.</p></li>
<li><p><code><a href="../reference/fixef.html">fixef()</a></code> is now imported (and re-exported) from the <em>nlme</em> package, with methods for models fitted with <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam()</a></code> and <code><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">gamm()</a></code>, to extract fixed effects estimates from fitted models. <code><a href="../reference/fixef.gam.html">fixed_effects()</a></code> is an alias for <code><a href="../reference/fixef.html">fixef()</a></code>.</p></li>
<li><p>The <code><a href="../reference/draw.html">draw()</a></code> method for <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> can now handle 2D smooths. Additionally, the number of posterior draws to plot can now be specified when plotting using new argument <code>n_samples</code>, which will result in <code>n_samples</code> draws being selected at random from the set of draws for plotting. New argument <code>seed</code> allows the selection of draws to be repeatable.</p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-7-0">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-7-0"></a></h3>
<ul><li><p><code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> was not filtering user-supplied data for the by level of the specific smooth when used with by factor smooths. This would result in the smooth being evaluated at all rows of the user-supplied data, and therefore would result in <code>nrow(user_data) * nlevels(by_variable)</code> rows in the returned object instead of <code>nrow(user_data)</code> rows.</p></li>
<li><p>The <code><a href="../reference/add_confint.html">add_confint()</a></code> method for <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> had the upper and lower intervals reversed. <a href="https://github.com/gavinsimpson/gratia/issues/107" class="external-link">#107</a> Reported by <a href="https://github.com/Aariq" class="external-link">@Aariq</a></p></li>
<li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> and <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> were both ignoring the <code>dist</code> argument that allows covariate values that lie too far from the support of the data to be excluded when returning estimated values from the smooth and plotting it. <a href="https://github.com/gavinsimpson/gratia/issues/111" class="external-link">#111</a> Reported by <a href="https://github.com/Aariq" class="external-link">@Aariq</a></p></li>
<li><p><code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> with a factor by GAM would return samples for the first factor level only. Reported by <a href="https://github.com/rroyaute" class="external-link">@rroyaute</a> in discussion of <a href="https://github.com/gavinsimpson/gratia/issues/121" class="external-link">#121</a></p></li>
<li><p><code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> would fail if the model contained random effect “smooths”. These are now ignored with a message when running <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code>. Reported by <a href="https://github.com/isabellaghement" class="external-link">@isabellaghement</a> in <a href="https://github.com/gavinsimpson/gratia/issues/121" class="external-link">#121</a></p></li>
<li><p><code><a href="../reference/link.html">link()</a></code>, <code><a href="../reference/link.html">inv_link()</a></code> were failing on models fitted with <code>family = scat()</code>. Reported by <a href="https://github.com/Aariq" class="external-link">@Aariq</a> <a href="https://github.com/gavinsimpson/gratia/issues/130" class="external-link">#130</a></p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.6.0" id="gratia-060">gratia 0.6.0<a class="anchor" aria-label="anchor" href="#gratia-060"></a></h2><p class="text-muted">CRAN release: 2021-04-18</p>
<div class="section level3">
<h3 id="major-changes-0-6-0">Major changes<a class="anchor" aria-label="anchor" href="#major-changes-0-6-0"></a></h3>
<ul><li>
<p>The {cowplot} package has been replaced by the {patchwork} package for producing multi-panel figures in <code><a href="../reference/draw.html">draw()</a></code> and <code><a href="../reference/appraise.html">appraise()</a></code>. This shouldn’t affect any code that used {gratia} only, but if you passed additional arguments to <code>cowplot::plot_grid()</code> or used the <code>align</code> or <code>axis</code> arguments of <code><a href="../reference/draw.html">draw()</a></code> and <code><a href="../reference/appraise.html">appraise()</a></code>, you’ll need to adapt code accordingly.</p>
<p>Typically, you can simply delete the <code>align</code> or <code>axis</code> arguments and {patchwork} will just work and align plots nicely. Any arguments passed via <code>...</code> to <code>cowplot::plot_grid()</code> will just be ignored by <code><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">patchwork::wrap_plots()</a></code> unless those passed arguments match any of the arguments of <code><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">patchwork::wrap_plots()</a></code>.</p>
</li>
</ul></div>
<div class="section level3">
<h3 id="new-features-0-6-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-6-0"></a></h3>
<ul><li><p>The {patchwork} package is now used for multi-panel figures. As such, {gratia} no longer Imports from the {cowplot} package.</p></li>
<li>
<p>Worm plot diagnostic plots are available via new function <code><a href="../reference/worm_plot.html">worm_plot()</a></code>. Worm plots are detrended Q-Q plots, where deviation from the Q-Q reference line are emphasized as deviations around the line occupy the full height of the plot.</p>
<p><code><a href="../reference/worm_plot.html">worm_plot()</a></code> methods are available for models of classes <code>"gam"</code>, <code>"glm"</code>, and <code>"lm"</code>. (<a href="https://github.com/gavinsimpson/gratia/issues/62" class="external-link">#62</a>)</p>
</li>
<li>
<p>Smooths can now be compared across models using <code><a href="../reference/compare_smooths.html">compare_smooths()</a></code>, and comparisons visualised with the associated <code><a href="../reference/draw.html">draw()</a></code> method. (<a href="https://github.com/gavinsimpson/gratia/issues/85" class="external-link">#85</a> <a href="https://github.com/dill" class="external-link">@dill</a>)</p>
<p>This feature is a bit experimental; the returned object uses nested lists and may change in the future if users find this confusing.</p>
</li>
<li><p>The reference line in <code><a href="../reference/qq_plot.html">qq_plot()</a></code> with <code>method = "normal"</code> was previously drawn as a line with intercept 0 and slope 1, to match the other methods. This was inconsistent with <code><a href="https://rdrr.io/r/stats/qqnorm.html" class="external-link">stats::qqplot()</a></code> which drew the line through the 1st and 3rd quartiles. <code><a href="../reference/qq_plot.html">qq_plot()</a></code> with <code>method = "normal"</code> now uses this robust reference line. Reference lines for the other methods remain drawn with slope 1 and intercept 0.</p></li>
<li><p><code><a href="../reference/qq_plot.html">qq_plot()</a></code> with <code>method = "normal"</code> now draws a point-wise reference band using the standard error of the order statistic.</p></li>
<li><p>The <code><a href="../reference/draw.html">draw()</a></code> method for <code><a href="../reference/penalty.html">penalty()</a></code> now plots the penalty matrix heatmaps in a more-logical orientation, to match how the matrices might be written down or printed to the R console.</p></li>
<li><p><code><a href="../reference/link.html">link()</a></code>, and <code><a href="../reference/link.html">inv_link()</a></code> now work for models fitted with the <code><a href="https://rdrr.io/pkg/mgcv/man/gumbls.html" class="external-link">gumbls()</a></code> and <code><a href="https://rdrr.io/pkg/mgcv/man/shash.html" class="external-link">shash()</a></code> families. (<a href="https://github.com/gavinsimpson/gratia/issues/84" class="external-link">#84</a>)</p></li>
<li><p><code><a href="../reference/link.html">extract_link()</a></code> is a lower level utility function related to <code><a href="../reference/link.html">link()</a></code> and <code><a href="../reference/link.html">inv_link()</a></code>, and is now exported.</p></li>
</ul></div>
<div class="section level3">
<h3 id="user-visible-changes-0-6-0">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-6-0"></a></h3>
<ul><li><p>The default method name for generating reference quantiles in <code><a href="../reference/qq_plot.html">qq_plot()</a></code> was changed from <code>"direct"</code> to <code>"uniform"</code>, to avoid confusion with the <code><a href="https://rdrr.io/pkg/mgcv/man/qq.gam.html" class="external-link">mgcv::qq.gam()</a></code> help page description of the methods. Accordingly using <code>method = "direct"</code> is deprecated and a message to this effect is displayed if used.</p></li>
<li><p>The way smooths/terms are selected in <code><a href="../reference/derivatives.html">derivatives()</a></code> has been switched to use the same mechanism as <code><a href="../reference/draw.gam.html">draw.gam()</a></code>’s <code>select</code> argument. To get a partial match to <code>term</code>, you now need to also specify <code>partial_match = TRUE</code> in the call to <code><a href="../reference/derivatives.html">derivatives()</a></code>.</p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-6-0">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-6-0"></a></h3>
<ul><li><p><code><a href="../reference/transform_fun.html">transform_fun()</a></code> had a copy paste bug in the definition of the then generic. (<a href="https://github.com/gavinsimpson/gratia/issues/96" class="external-link">#96</a> <a href="https://github.com/Aariq" class="external-link">@Aariq</a>)</p></li>
<li><p><code><a href="../reference/derivatives.html">derivatives()</a></code> with user-supplied <code>newdata</code> would fail for factor by smooths with <code>interval = "simultaneous"</code> and would introduce rows with derivative == 0 with <code>interval = "confidence"</code> because it didn’t subset the rows of <code>newdata</code> for the specific level of the by factor when computing derivatives. (<a href="https://github.com/gavinsimpson/gratia/issues/102" class="external-link">#102</a> <a href="https://github.com/sambweber" class="external-link">@sambweber</a>)</p></li>
<li><p><code><a href="../reference/evaluate_smooth.html">evaluate_smooth()</a></code> can now handle random effect smooths defined using an ordered factor. (<a href="https://github.com/gavinsimpson/gratia/issues/99" class="external-link">#99</a> <a href="https://github.com/StefanoMezzini" class="external-link">@StefanoMezzini</a>)</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.5.1" id="gratia-051">gratia 0.5.1<a class="anchor" aria-label="anchor" href="#gratia-051"></a></h2><p class="text-muted">CRAN release: 2021-01-23</p>
<div class="section level3">
<h3 id="new-features-0-5-1">New features<a class="anchor" aria-label="anchor" href="#new-features-0-5-1"></a></h3>
<ul><li>
<p><code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> can now handle</p>
<ul><li>bivariate and multivariate thinplate regression spline smooths, e.g.  <code>s(x, z, a)</code>,</li>
<li>tensor product smooths (<code><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">te()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/t2.html" class="external-link">t2()</a></code>, &amp; <code><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti()</a></code>), e.g. <code>te(x, z, a)</code>
</li>
<li>factor smooth interactions, e.g. <code>s(x, f, bs = "fs")</code>
</li>
<li>random effect smooths, e.g. <code>s(f, bs = "re")</code>
</li>
</ul></li>
<li>
<p><code><a href="../reference/penalty.html">penalty()</a></code> provides a tidy representation of the penalty matrices of smooths. The tidy representation is most suitable for plotting with <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code>.</p>
<p>A <code><a href="../reference/draw.html">draw()</a></code> method is provided, which represents the penalty matrix as a heatmap.</p>
</li>
</ul></div>
<div class="section level3">
<h3 id="user-visible-changes-0-5-1">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-5-1"></a></h3>
<ul><li>The <code>newdata</code> argument to <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> has been changed to <code>data</code> as was originally intended.</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.5.0" id="gratia-050">gratia 0.5.0<a class="anchor" aria-label="anchor" href="#gratia-050"></a></h2><p class="text-muted">CRAN release: 2021-01-10</p>
<div class="section level3">
<h3 id="new-features-0-5-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-5-0"></a></h3>
<ul><li>
<p>Partial residuals for models can be computed with <code><a href="../reference/partial_residuals.html">partial_residuals()</a></code>. The partial residuals are the weighted residuals of the model added to the contribution of each smooth term (as returned by <code>predict(model,   type = "terms")</code>.</p>
<p>Wish of <a href="https://github.com/gavinsimpson/gratia/issues/76" class="external-link">#76</a> (<a href="https://github.com/noamross" class="external-link">@noamross</a>)</p>
<p>Also, new function <code><a href="../reference/add_partial_residuals.html">add_partial_residuals()</a></code> can be used to add the partial residuals to data frames.</p>
</li>
<li>
<p>Users can now control to some extent what colour or fill scales are used when plotting smooths in those <code><a href="../reference/draw.html">draw()</a></code> methods that use them. This is most useful to change the fill scale when plotting 2D smooths, or to change the discrete colour scale used when plotting random factor smooths (<code>bs = "fs"</code>).</p>
<p>The user can pass scales via arguments <code>discrete_colour</code> and <code>continuous_fill</code>.</p>
</li>
<li>
<p>The effects of certain smooths can be excluded from data simulated from a model using <code><a href="../reference/simulate.html">simulate.gam()</a></code> and <code><a href="../reference/predicted_samples.html">predicted_samples()</a></code> by passing <code>exclude</code> or <code>terms</code> on to <code><a href="https://rdrr.io/pkg/mgcv/man/predict.gam.html" class="external-link">predict.gam()</a></code>. This allows for excluding random effects, for example, from model predicted values that are then used to simulate new data from the conditional distribution. See the example in <code><a href="../reference/predicted_samples.html">predicted_samples()</a></code>.</p>
<p>Wish of <a href="https://github.com/gavinsimpson/gratia/issues/74" class="external-link">#74</a> (<a href="https://github.com/hgoldspiel" class="external-link">@hgoldspiel</a>)</p>
</li>
<li>
<p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> and related functions gain arguments <code>constant</code> and <code>fun</code> to allow for user-defined constants and transformations of smooth estimates and confidence intervals to be applied.</p>
<p>Part of wish of Wish of <a href="https://github.com/gavinsimpson/gratia/issues/79" class="external-link">#79</a>.</p>
</li>
<li><p><code><a href="../reference/confint.gam.html">confint.gam()</a></code> now works for 2D smooths also.</p></li>
<li><p><code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> is an early version of code to replace (or more likely supersede) <code><a href="../reference/evaluate_smooth.html">evaluate_smooth()</a></code>. <code><a href="../reference/smooth_estimates.html">smooth_estimates()</a></code> can currently only handle 1D smooths of the standard types.</p></li>
</ul></div>
<div class="section level3">
<h3 id="user-visible-changes-0-5-0">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-5-0"></a></h3>
<ul><li>
<p>The meaning of <code>parm</code> in <code>confint.gam</code> has changed. This argument now requires a smooth label to match a smooth. A vector of labels can be provided, but partial matching against a smooth label only works with a single <code>parm</code> value.</p>
<p>The default behaviour remains unchanged however; if <code>parm</code> is <code>NULL</code> then all smooths are evaluated and returned with confidence intervals.</p>
</li>
<li><p><code>data_class()</code> is no longer exported; it was only ever intended to be an internal function.</p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-5-0">Bug Fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-5-0"></a></h3>
<ul><li>
<p><code><a href="../reference/confint.gam.html">confint.gam()</a></code> was failing on a tensor product smooth due to matching issues. Reported by <a href="https://github.com/tamas-ferenci" class="external-link">@tamas-ferenci</a> <a href="https://github.com/gavinsimpson/gratia/issues/88" class="external-link">#88</a></p>
<p>This also fixes <a href="https://github.com/gavinsimpson/gratia/issues/80" class="external-link">#80</a></p>
<ol class="example" style="list-style-type: decimal"><li>which was a related issue with selecting a specific smooth.</li>
</ol></li>
<li><p>The <strong>vdiffr</strong> package is now used conditionally in package tests. Reported by Brian Ripley <a href="https://github.com/gavinsimpson/gratia/issues/93" class="external-link">#93</a></p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.4.1" id="gratia-041">gratia 0.4.1<a class="anchor" aria-label="anchor" href="#gratia-041"></a></h2><p class="text-muted">CRAN release: 2020-05-30</p>
<div class="section level3">
<h3 id="user-visible-changes-0-4-1">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-4-1"></a></h3>
<ul><li>
<p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> with <code>scales = "fixed"</code> now applies to all terms that can be plotted, including 2d smooths.</p>
<p>Reported by <a href="https://github.com/StefanoMezzini" class="external-link">@StefanoMezzini</a> <a href="https://github.com/gavinsimpson/gratia/issues/73" class="external-link">#73</a></p>
</li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-4-1">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-4-1"></a></h3>
<ul><li><p><code><a href="https://dplyr.tidyverse.org/reference/combine.html" class="external-link">dplyr::combine()</a></code> was deprecated. Switch to <code><a href="https://vctrs.r-lib.org/reference/vec_c.html" class="external-link">vctrs::vec_c()</a></code>.</p></li>
<li>
<p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> with <code>scales = "fixed"</code> wasn’t using fixed scales where 2d smooths were in the model.</p>
<p>Reported by <a href="https://github.com/StefanoMezzini" class="external-link">@StefanoMezzini</a> <a href="https://github.com/gavinsimpson/gratia/issues/73" class="external-link">#73</a></p>
</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.4.0" id="gratia-040">gratia 0.4.0<a class="anchor" aria-label="anchor" href="#gratia-040"></a></h2>
<div class="section level3">
<h3 id="new-features-0-4-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-4-0"></a></h3>
<ul><li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> can include partial residuals when drawing univariate smooths. Use <code>residuals = TRUE</code> to add partial residuals to each univariate smooth that is drawn. This feature is not available for smooths of more than one variable, by smooths, or factor-smooth interactions (<code>bs = "fs"</code>).</p></li>
<li>
<p>The coverage of credible and confidence intervals drawn by <code><a href="../reference/draw.gam.html">draw.gam()</a></code> can be specified via argument <code>ci_level</code>. The default is arbitrarily <code>0.95</code> for no other reason than (rough) compatibility with <code><a href="https://rdrr.io/pkg/mgcv/man/plot.gam.html" class="external-link">plot.gam()</a></code>.</p>
<p>This change has had the effect of making the intervals slightly narrower than in previous versions of <em>gratia</em>; intervals were drawn at ± 2 × the standard error. The default intervals are now drawn at ± ~1.96 × the standard error.</p>
</li>
<li><p>New function <code><a href="../reference/difference_smooths.html">difference_smooths()</a></code> for computing differences between factor smooth interactions. Methods available for <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/gamm.html" class="external-link">gamm()</a></code> and <code><a href="https://rdrr.io/pkg/gamm4/man/gamm4.html" class="external-link">gamm4::gamm4()</a></code>. Also has a <code><a href="../reference/draw.html">draw()</a></code> method, which can handle differences of 1D and 2D smooths currently (handling 3D and 4D smooths is planned).</p></li>
<li><p>New functions <code><a href="../reference/add_fitted.html">add_fitted()</a></code> and <code><a href="../reference/add_residuals.html">add_residuals()</a></code> to add fitted values (expectations) and model residuals to an existing data frame. Currently methods available for objects fitted by <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam()</a></code> and <code><a href="https://rdrr.io/pkg/mgcv/man/bam.html" class="external-link">bam()</a></code>.</p></li>
<li><p><code><a href="../reference/data_sim.html">data_sim()</a></code> is a tidy reimplementation of <code><a href="https://rdrr.io/pkg/mgcv/man/gamSim.html" class="external-link">mgcv::gamSim()</a></code> with the added ability to use sampling distributions other than the Gaussian for all models implemented. Currently Gaussian, Poisson, and Bernoulli sampling distributions are available.</p></li>
<li><p><code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> can handle continuous by variable smooths such as in varying coefficient models.</p></li>
<li><p><code><a href="../reference/link.html">link()</a></code> and <code><a href="../reference/link.html">inv_link()</a></code> now work for all families available in <em>mgcv</em>, including the location, scale, shape families, and the more specialised families described in <code><a href="https://rdrr.io/pkg/mgcv/man/family.mgcv.html" class="external-link">?mgcv::family.mgcv</a></code>.</p></li>
<li><p><code><a href="../reference/evaluate_smooth.html">evaluate_smooth()</a></code>, <code><a href="../reference/data_slice.html">data_slice()</a></code>, <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">family()</a></code>, <code><a href="../reference/link.html">link()</a></code>, <code><a href="../reference/link.html">inv_link()</a></code> methods for models fitted using <code>gamm4()</code> from the <strong>gamm4</strong> package.</p></li>
<li><p><code><a href="../reference/data_slice.html">data_slice()</a></code> can generate data for a 1-d slice (a single variable varying).</p></li>
<li>
<p>The colour of the points, reference lines, and simulation band in <code><a href="../reference/appraise.html">appraise()</a></code> can now be specified via arguments</p>
<ul><li>
<code>point_col</code>,</li>
<li>
<code>point_alpha</code>,</li>
<li><code>ci_col</code></li>
<li><code>ci_alpha</code></li>
<li><code>line_col</code></li>
</ul><p>These are passed on to <code><a href="../reference/qq_plot.html">qq_plot()</a></code>, <code><a href="../reference/observed_fitted_plot.html">observed_fitted_plot()</a></code>, <code><a href="../reference/residuals_linpred_plot.html">residuals_linpred_plot()</a></code>, and <code><a href="../reference/residuals_hist_plot.html">residuals_hist_plot()</a></code>, which also now take the new arguments were applicable.</p>
</li>
<li><p>Added utility functions <code><a href="../reference/is_factor_term.html">is_factor_term()</a></code> and <code><a href="../reference/term_variables.html">term_variables()</a></code> for working with models. <code><a href="../reference/is_factor_term.html">is_factor_term()</a></code> identifies is the named term is a factor using information from the <code><a href="https://rdrr.io/r/stats/terms.html" class="external-link">terms()</a></code> object of the fitted model. <code><a href="../reference/term_variables.html">term_variables()</a></code> returns a character vector of variable names that are involved in a model term. These are strictly for working with parametric terms in models.</p></li>
<li>
<p><code><a href="../reference/appraise.html">appraise()</a></code> now works for models fitted by <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> and <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>, as do the underlying functions it calls, especially <code>qq_plot</code>.</p>
<p><code><a href="../reference/appraise.html">appraise()</a></code> also works for models fitted with family <code><a href="https://rdrr.io/pkg/mgcv/man/gaulss.html" class="external-link">gaulss()</a></code>. Further location scale models and models fitted with extended family functions will be supported in upcoming releases.</p>
</li>
</ul></div>
<div class="section level3">
<h3 id="user-visible-changes-0-4-0">User visible changes<a class="anchor" aria-label="anchor" href="#user-visible-changes-0-4-0"></a></h3>
<ul><li><p><code><a href="../reference/datagen.html">datagen()</a></code> is now an <em>internal</em> function and is no longer exported. Use <code><a href="../reference/data_slice.html">data_slice()</a></code> instead.</p></li>
<li><p><code><a href="../reference/evaluate_parametric_term.html">evaluate_parametric_term()</a></code> is now much stricter and can only evaluate main effect terms, i.e. those whose order, as stored in the <code>terms</code> object of the model is <code>1</code>.</p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-4-0">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-4-0"></a></h3>
<ul><li><p>The <code><a href="../reference/draw.html">draw()</a></code> method for <code><a href="../reference/derivatives.html">derivatives()</a></code> was not getting the x-axis label for factor by smooths correctly, and instead was using <code>NA</code> for the second and subsequent levels of the factor.</p></li>
<li><p>The <code><a href="../reference/datagen.html">datagen()</a></code> method for class <code>"gam"</code> couldn’t possibly have worked for anything but the simplest models and would fail even with simple factor by smooths. These issues have been fixed, but the behaviour of <code><a href="../reference/datagen.html">datagen()</a></code> has changed, and the function is now not intended for use by users.</p></li>
<li><p>Fixed an issue where in models terms of the form <code>factor1:factor2</code> were incorrectly identified as being numeric parametric terms. <a href="https://github.com/gavinsimpson/gratia/issues/68" class="external-link">#68</a></p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.3.1" id="gratia-031">gratia 0.3.1<a class="anchor" aria-label="anchor" href="#gratia-031"></a></h2><p class="text-muted">CRAN release: 2020-03-29</p>
<div class="section level3">
<h3 id="new-features-0-3-1">New features<a class="anchor" aria-label="anchor" href="#new-features-0-3-1"></a></h3>
<ul><li>
<p>New functions <code><a href="../reference/link.html">link()</a></code> and <code><a href="../reference/link.html">inv_link()</a></code> to access the link function and its inverse from fitted models and family functions.</p>
<p>Methods for classes: <code>"glm"</code>, <code>"gam"</code>, <code>"bam"</code>, <code>"gamm"</code> currently. <a href="https://github.com/gavinsimpson/gratia/issues/58" class="external-link">#58</a></p>
</li>
<li><p>Adds explicit <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">family()</a></code> methods for objects of classes <code>"gam"</code>, <code>"bam"</code>, and <code>"gamm"</code>.</p></li>
<li><p><code><a href="../reference/derivatives.html">derivatives()</a></code> now handles non-numeric when creating shifted data for finite differences. Fixes a problem with <code>stringsAsFactors = FALSE</code> default in R-devel. <a href="https://github.com/gavinsimpson/gratia/issues/64" class="external-link">#64</a></p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-3-1">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-3-1"></a></h3>
<ul><li>Updated <em>gratia</em> to work with <em>tibble</em> versions &gt;= 3.0</li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.3.0" id="gratia-030">gratia 0.3.0<a class="anchor" aria-label="anchor" href="#gratia-030"></a></h2><p class="text-muted">CRAN release: 2020-01-19</p>
<div class="section level3">
<h3 id="new-features-0-3-0">New features<a class="anchor" aria-label="anchor" href="#new-features-0-3-0"></a></h3>
<ul><li>
<p><em>gratia</em> now uses the <em>mvnfast</em> package for random draws from a multivariate normal distribution (<code><a href="https://rdrr.io/pkg/mvnfast/man/rmvn.html" class="external-link">mvnfast::rmvn()</a></code>). Contributed by Henrik Singmann</p>
<ol start="2" class="example" style="list-style-type: decimal"><li><a href="https://github.com/gavinsimpson/gratia/issues/28" class="external-link">#28</a></li>
</ol></li>
<li><p>New function <code><a href="../reference/basis.html">basis()</a></code> for generating tidy representations of basis expansions from an <em>mgcv</em>-like definition of a smooth, e.g. <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">te()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">ti()</a></code>, or <code><a href="https://rdrr.io/pkg/mgcv/man/t2.html" class="external-link">t2()</a></code>. The basic smooth types also have a simple <code><a href="../reference/draw.html">draw()</a></code> method for plotting the basis. <code><a href="../reference/basis.html">basis()</a></code> is a simple wrapper around <code><a href="https://rdrr.io/pkg/mgcv/man/smoothCon.html" class="external-link">mgcv::smoothCon()</a></code> with some post processing of the basis model matrix into a tidy format. <a href="https://github.com/gavinsimpson/gratia/issues/42" class="external-link">#42</a></p></li>
<li><p>New function <code><a href="../reference/smooth_samples.html">smooth_samples()</a></code> to draw samples of entire smooth functions from their posterior distribution. Also has a <code><a href="../reference/draw.html">draw()</a></code> method for plotting the posterior samples.</p></li>
</ul></div>
<div class="section level3">
<h3 id="bug-fixes-0-3-0">Bug fixes<a class="anchor" aria-label="anchor" href="#bug-fixes-0-3-0"></a></h3>
<ul><li><p><code><a href="../reference/draw.gam.html">draw.gam()</a></code> would produce empty plots between the panels for the parametric terms if there were 2 or more parametric terms in a model. Reported by <a href="https://github.com/sklayn" class="external-link">@sklayn</a> <a href="https://github.com/gavinsimpson/gratia/issues/39" class="external-link">#39</a>.</p></li>
<li>
<p><code><a href="../reference/derivatives.html">derivatives()</a></code> now works with factor by smooths, including ordered factor by smooths. The function also now works correctly for complex models with multiple covariates/smooths. <a href="https://github.com/gavinsimpson/gratia/issues/47" class="external-link">#47</a></p>
<p><code><a href="../reference/derivatives.html">derivatives()</a></code> also now handles <code>'fs'</code> smooths. Reported by <a href="https://github.com/tomand-uio" class="external-link">@tomand-uio</a> <a href="https://github.com/gavinsimpson/gratia/issues/57" class="external-link">#57</a>.</p>
</li>
<li><p><code><a href="../reference/evaluate_parametric_term.html">evaluate_parametric_term()</a></code> and hence <code><a href="../reference/draw.gam.html">draw.gam()</a></code> would fail on a <code><a href="https://rdrr.io/pkg/mgcv/man/ziplss.html" class="external-link">ziplss()</a></code> model because i) <em>gratia</em> didn’t handle parametric terms in models with multiple linear predictors correctly, and ii) <em>gratia</em> didn’t convert to the naming convention of <em>mgcv</em> for terms in higher linear predictors. Reported by <a href="https://github.com/pboesu" class="external-link">@pboesu</a> <a href="https://github.com/gavinsimpson/gratia/issues/45" class="external-link">#45</a></p></li>
</ul></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://fromthebottomoftheheap.net" class="external-link">Gavin L. Simpson</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

